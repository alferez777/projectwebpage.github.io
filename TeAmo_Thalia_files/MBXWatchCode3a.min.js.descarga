/**
 * @license
 * Copyright (c) 2022 www.matchbox.fr - All Rights Reserved
 * Unauthorized using such as, but not limited to, copying, adapting, publishing of this file, or any part of its content, via any medium, is strictly prohibited.
 */
 "use strict";function OTW3(e){var t="_fileNamePart1",a="_fileNamePart2",n="_fileName",i="_initialX",o="_initialY",s="_instancesOfOTW3ById",r="_rotationRange",l="base64ImagesFileName",c="base64Images",d="baseRotation",u="contentType",g="cycleTimeUnit",m="data",h="date",f="deviceTime",p="displacementMapFileName",v="downloadSnapshot",w="dynamicContent",y="effectOfCyclop",T="elements",D="fileNameFormat",C="fileName",M="fileUrl",b="fullYear",I="hasChronoCapabilities",O="hasCountdownCapabilities",S="hasCyclop",F="hours",A="id",k="imageFolderName",N="initial",x="instancesHolder",W="isCompatibleWithRenderingModeCss",P="isTransitionalFromCodeVersion2",E="layersToFrameMethod",R="lightSource",_="maskFileName",Y="milliseconds",X="minutes",L="month",j="movingContent",U="newWatch",H="onSpinUpdateMoment",B="props",V="renderer",z="rotationMax",J="rotationMin",q="seconds",Q="staticContent",G="timepieceCenter",K="timepieceUnderCyclop",Z="timezone",$="visualEffect",ee="x",te="y",ae=this;if(!e||!e[A]||""==e[A])throw'OTW3 has to be instantiated with the property "id" defined in "propHolder"!';ae.id=e[A],ae.withCredentials=e.withCredentials,ae.hasPoorPerformances=!1,ae.isReady=!1,ae.layers=[],ae.validDateComponents=[h,b,F,Y,X,L,q];var ne=-1,ie={newWatch:{backgroundFileName:null,base64Images:null,base64ImagesFileName:null,baseRotation:0,height:0,imageFolderName:"img",lightSource:0,timepieceCenterX:0,timepieceCenterY:0,scaleX:100,scaleY:100,skewX:0,skewY:0,width:0},timepieceCenter:{id:null,x:0,y:0},timepieceUnderCyclop:{cyclopX:0,cyclopY:0,displacementMapDriftRangeX:15,displacementMapDriftRangeY:15,displacementMapFileName:null,fileName:null,maskFileName:null,timepieceOffsetX:0,timepieceOffsetY:0,zoomCoef:1},dynamicContent:{contentType:null,dst:null,effectOfCyclop:"none",fileNameDynamicValuePlaceholder:"[x]",fileNameFormat:null,timezone:f,onSpinUpdateMoment:0,x:0,y:0},movingContent:{anchorPointX:0,anchorPointY:0,cycleCountLimit:null,cycleDuration:0,cycleIsReversed:!1,cycleIsSmooth:!0,cycleTimeUnit:null,dst:null,effectOfCyclop:"zoom",fileName:null,id:null,isMaskOnly:!1,isOptional:!1,maskedById:null,maskedContentAnchorPointX:0,maskedContentAnchorPointY:0,maskFileName:null,maskMode:"drawOverOpaque",offsetX:0,offsetY:0,rotationMax:360,rotationMin:0,rotationOffset:0,scaleX:0,scaleY:0,skewX:0,skewY:0,timepieceCenterId:null,timezone:f,visualEffect:null},staticContent:{effectOfCyclop:"none",fileName:null,x:0,y:0}};ae.logger=new OTW3_logger({senderId:ae.id}),ae.toolbox=new OTW3_toolbox,ae.assetManager=new OTW3_assetManager({watch:ae}),ae.eventManager=new OTW3_eventManager({watch:ae}),ae.movement=new OTW3_movement({watch:ae}),ae.scenarioManager=new OTW3_scenarioManager({watch:ae});var oe=ae.logger,se=ae.toolbox,re=ae.assetManager,le=ae.eventManager,ce=ae.movement,de=ae.scenarioManager;e[V]||(e[V]=new OTW3_renderer({watch:ae}),e[E]="getFrameForCurrentLayers"),ae.renderer=e[V];var ue=ae.renderer;ae.rendererLayersToFrameMethod=e[E],le.addCallbackForEvent("movementDidTick",new Function("this.renderer."+this.rendererLayersToFrameMethod+"()").bind(ae)),ae.snapshotManager=new OTW3_snapshotManager({watch:ae});var ge=ae.snapshotManager;null==e[x]&&(e[x]="default"),"default"==e[x]?(window[s]||(window[s]={}),window[s][ae.id]=ae):"none"!=e[x]&&(e[x][ae.id]=ae),Object.defineProperty(this,"allowRendererToAutoSwitchToCanvasForDownloadSnapshot",{get:function(){return this.renderer.allowAutoSwitchToCanvasFor[v]},set:function(e){this.renderer.allowAutoSwitchToCanvasFor[v]=e},configurable:!0}),Object.defineProperty(this,"defaultStaticChronoElpasedTime",{get:function(){return this.movement.getDefaultStaticChronoElpasedTime()},set:function(e){this.movement.setDefaultStaticChronoElpasedTime(e)},configurable:!0}),Object.defineProperty(this,"defaultStaticCountdownElpasedTime",{get:function(){return this.movement.defaultStaticCountdownElpasedTime()},set:function(e){this.movement.defaultStaticCountdownElpasedTime(e)},configurable:!0}),Object.defineProperty(this,"defaultStaticDisplayDate",{get:function(){return this.movement.getDefaultStaticDisplayDate()},set:function(e){this.movement.setDefaultStaticDisplayDate(e)},configurable:!0}),Object.defineProperty(this,I,{value:!1,configurable:!0}),Object.defineProperty(this,O,{value:!1,configurable:!0}),Object.defineProperty(this,S,{value:!1,configurable:!0}),Object.defineProperty(this,"isPaused",{get:function(){return this.movement.isPaused},configurable:!0}),Object.defineProperty(this,W,{value:!0,configurable:!0}),Object.defineProperty(this,"isSpinning",{get:function(){return this.movement.isSpinning},configurable:!0}),null==e[P]&&(e[P]=!1),Object.defineProperty(this,"isTransitionalFromCodeVersion2",{value:e[P],configurable:!0}),Object.defineProperty(this,"newMoonReferenceDate",{get:function(){return this.movement.getNewMoonReferenceDate()},set:function(e){this.movement.setNewMoonReferenceDate(e)},configurable:!0}),Object.defineProperty(this,"optimizeRenderingReceipes",{get:function(){return this.renderer.optimizeRenderingReceipes},set:function(e){this.renderer.optimizeRenderingReceipes=e},configurable:!0}),Object.defineProperty(this,"renderDynamicContents",{get:function(){return this.renderer.renderDynamicContents},set:function(e){this.renderer.renderDynamicContents=e},configurable:!0}),Object.defineProperty(this,"renderMovingContents",{get:function(){return this.renderer.renderMovingContents},set:function(e){this.renderer.renderMovingContents=e},configurable:!0}),Object.defineProperty(this,"renderStaticContents",{get:function(){return this.renderer.renderStaticContents},set:function(e){this.renderer.renderStaticContents=e},configurable:!0}),Object.defineProperty(this,"renderVisualEffects",{get:function(){return this.renderer.renderVisualEffects},set:function(e){this.renderer.renderVisualEffects=e},configurable:!0}),Object.defineProperty(this,"renderingMode",{get:function(){return this.renderer.mode},set:function(e){"css"==e&&0==this.isCompatibleWithRenderingModeCss?this.logger.logWarning('OTW3 "renderingMode" not set to "css" because implementation is not compatible.'):this.renderer.initInMode(e)},configurable:!0}),Object.defineProperty(this,"watchCodeVersion",{value:"3.0.4-202207121451",configurable:!0}),ae.addDynamicContent=function(e){if(e&&e[u]&&""!=e[u]&&e[D]&&""!=e[D]){e[H]>=0&&e[H]<=100||delete e[H];var n,s=he(e,w),r=null,l=null;if(s[D]){var c=s[D].split(s.fileNameDynamicValuePlaceholder);r=c[0],l=c[1]}if(s[t]=r,s[a]=l,s[u]==h?n=31:"day"==s[u]?n=7:s[u]==L&&(n=12),!se.isArray(s[ee])){s[i]=s[ee],s[ee]=[];for(var d=1;d<=n;d++)s[ee].push(s[i])}if(!se.isArray(s[te])){s[o]=s[te],s[te]=[];for(d=1;d<=n;d++)s[te].push(s[o])}if(me(w,s),n>1)for(d=1;d<=n;d++)ve(s[t]+d+s[a])}},ae.addImplementationFromJson=function(e){if(e&&(e[m]&&""!=e[m]||e[M]&&""!=e[M]||e[T]&&!(e[T].length<1))){var t,a=["addDynamicContent","addMovingContent","addStaticContent","addTimepieceCenter","addTimepieceUnderCyclop","createNewWatch","followScenario","setTargetElement"],n=["allowRendererToAutoSwitchToCanvasForDownloadSnapshot","defaultStaticChronoElpasedTime","defaultStaticCountdownElpasedTime","defaultStaticDisplayDate","newMoonReferenceDate","renderingMode"],i={},o=e[T];o||(o=[e]);for(var s=0;s<o.length;s++){var r=o[s];r[M]?t=se.getDataFromJsonFileAtUrl(r[M],ae.withCredentials):r[m]&&(t=JSON.parse(r[m]));for(var l=0;l<t.length;l++){var c=t[l],d=c.type;if(a.indexOf(d)>-1){for(var u=c.args,g=0;g<u.length;g++){var h=u[g];for(var f in"string"==typeof h&&0==h.indexOf("var:")&&(u[g]=fe(h,i)),h=u[g])h[f]=fe(h[f],i)}ae[d](...u)}else if(n.indexOf(d)>-1){var p=c.value;p=fe(p,i),ae[d]=p}else"var"==d?i[c[A]]=fe(c.value,i):ae.logger.logInfo('OTW3 "addImplementationFromJson" does recognize instruction of type "'+d+'"')}}}};var me=function(e,t){var a={};a.type=e,a[B]={},a[B][N]=t,ne++,a[B][N]._internalId="internalId_"+ne,e!=w&&e!=j||(a[B].current={}),"timepieceUnderCyclop"==e?ae.layers.splice(1,0,a):ae.layers.push(a)}.bind(ae);ae.addMovingContent=function(e){void 0===e[y]&&(1==this.hasCyclop?e[y]="zoom":e[y]="hide");var t=he(e,j);for(null!=t[$]&&(t[$]=se.getCloneOf(t[$]));t[J]<0;)t[J]+=360;for(t[J]=t[J]%360;t[z]<0;)t[z]+=360;for(t[z]=t[z]%360,t[z]<=0&&(t[z]=360),t[g].indexOf("chrono")>-1&&Object.defineProperty(this,I,{value:!0,configurable:!0}),t[g].indexOf("countdown")>-1&&Object.defineProperty(this,O,{value:!0,configurable:!0}),t[r]=(t[z]-t[J])%360;t[r]<=0;)t[r]+=360;if(t[_]&&ve(t[_]),t[$]&&"overlayOpacityForRotation"==t[$].type)for(var a=0;a<t[$][T].length;a++)if(t[$][T][a].opacityRange=t[$][T][a].opacityEnd-t[$][T][a].opacityStart,t[C]){var i=t[C].split(".");t[$][T][a][n]=i[0]+"_"+t[$][T][a].fileNameSuffix+"."+i[1],ve(t[$][T][a][n])}me(j,t),ve(t[C])},ae.addStaticContent=function(e){if(e&&e[C]&&""!=e[C]){var t=he(e,Q);me(Q,t),ve(t[C])}},ae.addTimeOffset=function(e,t){ae.validDateComponents.indexOf(e)>-1?0!=t&&ce.addTimeOffset(e,t):oe.logWarning('OTW3 "addTimeOffset" with "dateComponent" = "'+e+'" is not supported, will do nothing')},ae.addTimepieceCenter=function(e){if(e&&e[A]&&""!=e[A]){var t=he(e,G);me(G,t)}},ae.addTimepieceUnderCyclop=function(e){var t=he(e,K);t[C]&&null==t[_]&&null==t[p]&&(t[_]=t[C].split(".png")[0]+"_mask.png"),t._maskBounds=null,t._displacementMapBounds=null,t[p]&&Object.defineProperty(this,W,{value:!1,configurable:!0}),Object.defineProperty(this,S,{value:!0,configurable:!0}),me(K,t),ve(t[_]),ve(t[p])};var he=function(e,t){var a={},n=ie[t];for(var i in n)a[i]=pe(e,i,n[i]);for(var i in e)void 0===n[i]&&this.logger.logWarning('"'+t+'" does not know about the property "'+i+'" and will be ignored.');return a}.bind(ae);ae.createNewWatch=function(e){for(var t=he(e,U);t[R]<0;)t[R]+=360;for(t[R]=t[R]%360;t[d]<0;)t[d]+=360;t[d]=t[d]%360,me(U,t),ve(t.backgroundFileName),t[l]&&re.addBase64ImagesFilePath(t[k],t[l]),t[c]&&re.addBase64Images(t[k],t[c])},ae.delete=function(t,a){ce.die(),ae.layers=[],ge.die(),de.die(),ue.die(),re.die(),le.startDying(),"default"==e[x]?window&&window[s]&&(window[s][this.id]=void 0,delete window[s][this.id]):"none"!=e[x]&&e[x]&&(e[x][this.id]=void 0,delete e[x][this.id]),ae&&ue&&ue.engine&&ue.engine.globalContainer&&ue.engine.globalContainer.parentNode&&ue.engine.globalContainer.parentNode.removeChild(ue.engine.globalContainer),le.fireEvent("willDie"),le.die(),Object.keys(this).forEach(e=>{this[e]=null,delete this[e]}),delete this.allowRendererToAutoSwitchToCanvasForDownloadSnapshot,delete this.defaultStaticChronoElpasedTime,delete this.defaultStaticCountdownElpasedTime,delete this.defaultStaticDisplayDate,delete this.hasChronoCapabilities,delete this.hasCountdownCapabilities,delete this.hasCyclop,delete this.isCompatibleWithRenderingModeCss,delete this.isPaused,delete this.isSpinning,delete this.isTransitionalFromCodeVersion2,delete this.newMoonReferenceDate,delete this.renderingMode,delete this.watchCodeVersion,t&&t[a]&&(t[a]=void 0)},ae.downloadSnapshotImage=function(e){"canvas"==ae.renderingMode?ge.downloadSnapshotImage(e):1==ue.allowAutoSwitchToCanvasFor[v]?(ae.renderingMode="canvas",ge.downloadSnapshotImage(e),ae.renderingMode="css"):oe.logInfo('OTW3 "downloadSnapshotImage" is only compatible with the "renderingMode" set to "canvas" or with "allowRendererToAutoSwitchToCanvasForDownloadSnapshot" set to "true".')},ae.emulateRealWorldInteraction=function(e){console.log("emulateRealWorldInteraction with props:"+JSON.stringify(e)),e.action},ae.enableLogs=function(e){this.logger.logsAreEnabled=e},ae.followScenario=function(e){de.followScenario(e)},ae.getDefaultValuesForLayerForProp=function(){return ie},ae.getInformations=function(){for(var e="-----",t=e+e+e+e+e+e+e+e+e+e,a=new Date,n=JSON.stringify(ae.getPathsToNecessaryAssets()),i=JSON.stringify(ae.layers),o=JSON.parse(i),s={},r=0;r<o.length;r++){var l=o[r];l[B]&&l[B][N]&&l[B][N][Z]&&(s[l[B][N][Z]]=!0)}var c=Object.keys(s),d="";return d+="\n"+t,d+='\nWatch ID: "'+ae.id+'"',d+="\nas of "+a,d+="\n"+t,d+="\nWatch code version: "+ae.watchCodeVersion,d+="\nImplementation is transitional from code version 2.x.x: "+ae.isTransitionalFromCodeVersion2,d+="\nImplementation is compatible with rendering mode CSS: "+ae.isCompatibleWithRenderingModeCss,d+="\nHas cyclop: "+ae.hasCyclop,d+="\nHas chrono: "+ae.hasChronoCapabilities,d+="\nHas countdown: "+ae.hasCountdownCapabilities,d+="\nCurrent rendering mode: "+ae.renderingMode,d+="\nCount of computed timezones: "+c.length+' ("'+c.join('", "')+'")',d+="\nWatch is paused: "+ae.isPaused,d+="\nWatch is pinning: "+ae.isSpinning,d+="\nNecessary assets:\n",d+=n,d+="\nWatch layers:\n",d+=i,d+="\n"+t};var fe=function(e,t){var a=":",n="utcDate",i="date"+a,o="var"+a;if("string"==typeof e){if(0==e.indexOf(n)){var s=e.split(n)[1].split(",");e=new Date(Date.UTC(...s))}else if(0==e.indexOf(i)){s=e.split(i)[1].split(",");e=new Date(...s)}else if(0==e.indexOf(o)){e=t[e.split(o)[1]]}}else if("Array"==e.constructor.name)for(var r=0;r<e.length;r++)e[r]=fe(e[r],t);else if("Object"==e.constructor.name)for(var l in e)e[l]=fe(e[l],t);return e};ae.getLayers=function(){return ae.layers},ae.getPathsToNecessaryAssets=function(){return re.getPathsToNecessaryAssets()};var pe=function(e,t,a){var n=a;return null!==e[t]&&void 0!==e[t]&&""!==e[t]&&(n=e[t]),n};ae.jumpToDate=function(e){ce.jumpToDate(e)},ae.jumpToDateAndPause=function(e){ce.jumpToDateAndPause(e)},ae.jumpToDateAndRun=function(e){ce.jumpToDateAndRun(e)},ae.jumpToDefaultStaticDisplayDate=function(){ce.jumpToDefaultStaticDisplayDate()},ae.jumpToDisplayDate=function(e){ce.jumpToDisplayDate(e)},ae.jumpToDisplayDateAndPause=function(e){ce.jumpToDisplayDateAndPause(e)},ae.jumpToDisplayDateAndRun=function(e){ce.jumpToDisplayDateAndRun(e)},ae.pause=function(){ce.pause()};var ve=function(e){e&&re.populateNecessaryImage(ae.layers[0][B][N][k],e)}.bind(ae);ae.resetChrono=function(){ce.resetChrono()},ae.resetCountdown=function(){ce.resetCountdown()},ae.resetTimeOffset=function(){ce.resetTimeOffset()},ae.run=function(){ce.run()},ae.setTargetElement=function(e){var t;e?(e.targetElementId?t=document.getElementById(e.targetElementId):e.targetElement?t=e.targetElement:oe.logWarning('OTW3 "setTargetElement" called with "propHolder" not providing "targetElementId" or "targetElement", will do nothing'),t&&ue.setTargetElement(t)):oe.logWarning('OTW3 "setTargetElement" called without "propHolder", will do nothing')},ae.setTimeOffset=function(e,t){ae.validDateComponents.indexOf(e)>-1?ce.setTimeOffset(e,t):oe.logWarning('OTW3 "setTimeOffset" with "dateComponent" = "'+e+'" is not supported, will do nothing')},ae.spinToDate=function(e){ce.spinToDate(e)},ae.spinToDateAndPause=function(e){ce.spinToDateAndPause(e)},ae.spinToDateAndRun=function(e){ce.spinToDateAndRun(e)},ae.spinToDefaultStaticDisplayDate=function(){ce.spinToDefaultStaticDisplayDate()},ae.spinToDisplayDate=function(e){ce.spinToDisplayDate(e)},ae.spinToDisplayDateAndPause=function(e){ce.spinToDisplayDateAndPause(e)},ae.spinToDisplayDateAndRun=function(e){ce.spinToDisplayDateAndRun(e)},ae.startChrono=function(){ce.startChrono()},ae.startCountdown=function(){ce.startCountdown()},ae.stopChrono=function(){ce.stopChrono()},ae.stopCountdown=function(){ce.stopCountdown()},!0===e.enableLogs&&ae.enableLogs(!0),oe.logInfoSeparator(),oe.logInfo("New OTW instance created with id = "+this.id),oe.logInfoSeparator()}function OTW3_assetManager(e){var t=this;t.watch=e.watch;var a={};t.imagesByFolderName={},t.base64ImagesFiles=[],t.base64ImagesJsons=[],t.countOfImagesToLoad=0;var n=!1,i=!1,o=t.imagesByFolderName,s=t.base64ImagesFiles,r=t.base64ImagesJsons;t.die=function(){n=!1,t.countOfImagesToLoad=0},t.populateNecessaryImage=function(e,t){if(e&&t){var n=e+"/"+t;0==t.indexOf("http")&&(n=t,e=""),a[n]={imageFolderName:e,fileName:t}}},t.addBase64ImagesFilePath=function(e,t){var a=e+"/"+t;s.push(a)},t.addBase64Images=function(e,t){o[e]||(o[e]={});var a=o[e];for(var n in t)t[n]&&t[n].data&&(a[n]=new Image,a[n].src=t[n].data)},t.loadAllNecessaryAssetsNow=function(){if(0==i){if(i=!0,n=!0,s.length>0)for(var e=0;e<s.length;e++){var o=t.watch.toolbox.getDataFromJsonFileAtUrl(s[e],t.watch.withCredentials);r.push(o)}var l=[];for(var c in a)l.push(a[c]);t.loadImageSet({imageSet:l})}},t.getPathsToNecessaryAssets=function(){var e=[];for(var t in a)e.push(t);return e.sort(),e},t.loadImage=function(e){var a=e.imageFolderName,n=e.fileName;e.onImageLoadedCallback;if(o[a]||(o[a]={}),!o[a][n]||1==e.forceRefresh){t.countOfImagesToLoad++,o[a][n]=new Image,o[a][n].onload=function(){t.countOfImagesToLoad--,t.fireOnAllLoadedIfAppropriate()}.bind(t);var i,l=null;if(r.length<1&&s.length>0)for(var c=0;c<s.length;c++){var d=t.watch.toolbox.getDataFromJsonFileAtUrl(s[c],t.watch.withCredentials);r.push(d)}if(r.length>0)for(c=0;c<r.length;c++)r[c]&&r[c].images&&r[c].images[n]&&r[c].images[n].data&&(l=r[c].images[n].data);null!=l?i=l:(i=a+"/"+n,0==n.indexOf("http")&&(i=n)),o[a][n].src=i}},t.fireOnAllLoadedIfAppropriate=function(){1==n&&t.countOfImagesToLoad<=1&&(t.watch.eventManager.fireEvent("allNecessaryImagesLoaded"),n=!1,i=!1)},t.loadImageSet=function(e){for(var a=0;a<e.imageSet.length;a++)t.loadImage(e.imageSet[a]);t.fireOnAllLoadedIfAppropriate()},t.getImage=function(e){var a=e.imageFolderName,n=e.fileName,i=!1;return o[a]&&o[a][n]&&o[a][n].complete&&"undefined"!=o[a][n].naturalWidth&&0!=o[a][n].naturalWidth&&(i=!0),1==i?o[a][n]:(o[a]&&o[a][n]||t.loadImage(e),null)}}function OTW3_date(){var e=this;e.dateObj,e.populateWithDateAndOffestsForTimezone=function(t,a,n,i){var o;if(o=t?new Date(t.getTime()):new Date,i&&0==i.indexOf("utc")){var s=0;"utc"!=i&&(0==i.indexOf("utc+")?s=Number(i.split("utc+")[1]):0==i.indexOf("utc-")&&(s=-Number(i.split("utc-")[1]))),e.dateObj=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes()+s,o.getUTCSeconds(),o.getUTCMilliseconds())}else e.dateObj=o;e.applyOffsets(a,n)},e.applyOffsets=function(t,a){var n=e.dateObj;if(t){var i="fullYear",o="month",s="date",r="hours",l="minutes",c="seconds",d="milliseconds";t[i]&&n.setFullYear(n.getFullYear()+t[i]),t[o]&&n.setMonth(n.getMonth()+t[o]),t[s]&&n.setDate(n.getDate()+t[s]),t[r]&&n.setHours(n.getHours()+t[r]),t[l]&&n.setMinutes(n.getMinutes()+t[l]),t[c]&&n.setSeconds(n.getSeconds()+t[c]),t[d]&&n.setMilliseconds(n.getMilliseconds()+t[d])}a&&n.setMilliseconds(n.getMilliseconds()+a),e.milliseconds=n.getMilliseconds(),e.seconds=n.getSeconds(),e.minutes=n.getMinutes(),e.hours=n.getHours(),e.date=n.getDate(),e.day=n.getDay(),e.month=n.getMonth(),e.fullYear=n.getFullYear(),e.secondsAsMilliseconds=1e3*e.seconds+e.milliseconds,e.minutesAsMilliseconds=60*e.minutes*1e3+e.secondsAsMilliseconds,e.hoursAsMilliseconds=60*e.hours*60*1e3+e.minutesAsMilliseconds,e.dateAsMilliseconds=24*e.date*60*60*1e3+e.hoursAsMilliseconds},e.applyScheduledTimeOffsetObject=function(t){var a=e.dateObj;if(t){var n=t.minutesOffset,i=new Date(t.startDate),o=new Date(t.endDate);o.setMinutes(o.getMinutes()-n),i<a&&a<o&&a.setMinutes(a.getMinutes()+n)}},e.getClone=function(){var t=new OTW3_date;return t.populateWithDateAndOffestsForTimezone(e.dateObj,null,null,null),t}}function OTW3_eventManager(e){this.watch=e.watch;var t={firstTimeRendered:{fireMaxCount:1,fireCurrentCount:0},movementDidTick:{fireMaxCount:0,fireCurrentCount:0},allNecessaryImagesLoaded:{fireMaxCount:0,fireCurrentCount:0}},a=[],n={},i=-1,o=[];this.startDying=function(){t={},n={}},this.die=function(){t={},n={},a=[]},this.addCallbackForEvent=function(e,s){if("willDie"==e)return i++,a.push(i),o[i]=s,i;if(t[e]){if(0==t[e].fireMaxCount||t[e].fireCurrentCount<t[e].fireMaxCount)return n[e]||(n[e]=[]),i++,n[e].push(i),o[i]=s,i;this.watch.logger.logWarning('OTW3_eventManager will not fire "'+e+'" again as its fireMaxCount has already been reached')}else this.watch.logger.logWarning('OTW3_eventManager does not know about event "'+e+'" and thus cannot add a callback for it')},this.removeCallbackHavingId=function(e){null!==o[e]&&(o[e]=null)};var s=function(e){if("willDie"==e)for(var i=0;i<a.length;i++)null!==a[i]?null!==o[a[i]]&&o[a[i]](this.watch):this.watch.logger.logWarning("OTW3_eventManager dyingCallback callback is null, cannot fire it");else if(t[e]){if(0==t[e].fireMaxCount||t[e].fireCurrentCount<t[e].fireMaxCount){if(n[e])for(i=0;i<n[e].length;i++)null!==n[e][i]?null!==o[n[e][i]]&&o[n[e][i]](this.watch):this.watch.logger.logWarning("OTW3_eventManager "+e+"callback is null, cannot fire it");t[e].fireCurrentCount++}}else this.watch.logger.logWarning('OTW3_eventManager does not know about event "'+e+'" and thus cannot execute a callback for it')}.bind(this);this.fireEvent=function(e){s(e)}}function OTW3_logger(e){var t=this;t.senderId=e.senderId,t.errorLogsAreEnabled=!0,t.infoLogsAreEnabled=!0,t.warningLogsAreEnabled=!0,t.logsAreEnabled=!1;var a=function(e,a){1==t.logsAreEnabled&&console.log("["+e+'] ["'+t.senderId+'"] '+a)}.bind(t);t.logError=function(e){1==t.errorLogsAreEnabled&&a("ERR",e)},t.logInfo=function(e){1==t.infoLogsAreEnabled&&a("(i)",e)},t.logInfoSeparator=function(){var e="-----";a("(i)",e+e+e+e+e+e+e+e+e+e)},t.logWarning=function(e){1==t.warningLogsAreEnabled&&a("!!!",e)}}function OTW3_movement(e){var t=this;t.watch=e.watch,t.defaultSpinDuration=2e3,t.defaultStaticDisplayDate=new Date(2006,7,28,10,11,31),t.isDisplayingDefaultStaticDate=!1,t.isPaused=!0,t.isSpinning=!1,t.frameAnimator=null,t.frameAnimatorTimeout=null,t.lastPresentedDateWasDisplayDate=!1,t.lastPauseDate=null,t.madeFirstTick=!1,t.millisecondsLateDueToPause=0,t.offsetsFor={},t.realWorldTicksPerSecond=8,t.ticker=null,t.timeSpeedMultiplier=1,t.timeSpeedMultiplierManipulationStartDate=null,t.willBeDisplayingDefaultStaticDate=!1;var a=new Date(Date.UTC(2022,5,29,2,52,0)),n=Math.round(2551442801.5584);t.ticksPerSecond=t.realWorldTicksPerSecond,t.chronoIsStopped=!0,t.chronoStartDate=null,t.chronoTotalElapsedTime=0,t.defaultStaticChronoElpasedTime=32814e3,t.chronoElapsedTimeAtStart=0,t.countdownIsStopped=!0,t.countdownStartDate=null,t.countdownTotalElapsedTime=0,t.defaultStaticCountdownElpasedTime=27e3,t.countdownElapsedTimeAtStart=6e4,t.die=function(){clearTimeout(t.frameAnimatorTimeout),t.frameAnimatorTimeout=null,delete t.frameAnimatorTimeout,clearInterval(t.ticker),t.ticker=null,delete t.ticker,cancelAnimationFrame(t.frameAnimator),t.frameAnimator=null,delete t.frameAnimator,t.watch=null,delete t.watch},t.addTimeOffset=function(e,a){t.setTimeOffset(e,t.offsetsFor[e]+a)},t.applyStatusToLayers=function(e,a,n){var r="chronoElapsedTimeToConsider",l="countdownElapsedTimeToConsider",c="cycleTimeUnit",d="date",u="elapsedTime",g="spinDuration";n||(n={}),n[d]||(n[d]=new Date),void 0===n[g]&&(n[g]=t.defaultSpinDuration),n[l]||(n[l]=t.countdownElapsedTimeAtStart),n[r]||(n[r]=t.chronoElapsedTimeAtStart),1==n.ignoreTimeOffsets&&(a=null);var m=0,h=0;1==n.addSpinDurationToTargetDate&&(t.millisecondsLateDueToPause-=n[g],m+=n[g],h+=n[g]),1==n.removeSpinDurationToTargetDate&&(t.millisecondsLateDueToPause+=n[g]);for(var f={},p=0;p<e.length;p++){var v=e[p],w=v.type,y=v.props.initial,T=v.props.current,D=y.timezone,C=y.dst;1==n.ignoreTimezone&&(D="");var M=0;if(t.timeSpeedMultiplier>1)M=(new Date-t.timeSpeedMultiplierManipulationStartDate)*t.timeSpeedMultiplier;if(f[D]||(f[D]=new OTW3_date,M>0&&n[d].setMilliseconds(n[d].getMilliseconds()+M),f[D].populateWithDateAndOffestsForTimezone(n[d],a,-t.millisecondsLateDueToPause,D)),"dynamicContent"==w){T[d]=f[D].getClone();var b=s(T[d],y.contentType);T.targetFileName=y._fileNamePart1+b+y._fileNamePart2,T.targetX=y.x[b-1],T.targetY=y.y[b-1]}else if("movingContent"==w){var I;if("countdown_minutes"==y[c]||"countdown_seconds"==y[c])if(null!=t.countdownStartDate){if(1==t.countdownIsStopped)T[u]=t.countdownTotalElapsedTime+t.countdownElapsedTimeAtStart;else{var O=new Date;T[u]=O.getTime()-t.countdownStartDate.getTime()+t.countdownElapsedTimeAtStart+t.countdownTotalElapsedTime+h}M>0&&(T[u]+=M)}else T[u]=n[l];else if("chrono_hours"==y[c]||"chrono_minutes"==y[c]||"chrono_seconds"==y[c])if(null!=t.chronoStartDate){if(1==t.chronoIsStopped)T[u]=t.chronoTotalElapsedTime+t.chronoElapsedTimeAtStart;else{O=new Date;T[u]=O.getTime()-t.chronoStartDate.getTime()+t.chronoElapsedTimeAtStart+t.chronoTotalElapsedTime+m}M>0&&(T[u]+=M)}else T[u]=n[r];else if(T[d]=f[D].getClone(),0==n.ignoreDst&&C&&"deviceTime"!=D){for(var S=0;S<C.length;S++)T[d].applyScheduledTimeOffsetObject(C[S]);T[d]=T[d].getClone()}I=o(v,n),T.targetRotation=I,i(v)}}};var i=function(e){for(var t="elements",a="initial",n="props",i="rotationEnd",o="rotationIsInRange",s="rotationStart",r="visualEffect",l=e[n][a],c=e[n].current,d=c.targetRotation-this.watch.layers[0][n][a].lightSource;d<0;)d+=360;if(d%=360,l[r]&&(c[r]||(c[r]={}),c[r][t]=[],"overlayOpacityForRotation"==l[r].type))for(var u=0;u<l[r][t].length;u++){var g=l[r][t][u],m={};if(m[o]=!1,g[i]<g[s]?(d>=g[s]&&d<=360||d>=0&&d<=g[i])&&(m[o]=!0):d>=g[s]&&d<=g[i]&&(m[o]=!0),1==m[o]){var h=d-g[s],f=g[i]-g[s];m.targetOpacity=this.watch.toolbox.getEasedValue(g.easingEquation,h,g.opacityStart,g.opacityRange,f)}c[r][t].push(m)}}.bind(t);t.getDefaultStaticChronoElpasedTime=function(){return t.defaultStaticChronoElpasedTime},t.getDefaultStaticDisplayDate=function(e){return new Date(t.defaultStaticDisplayDate.getTime())},t.getNewMoonReferenceDate=function(){return new Date(a.getTime())};var o=function(e,t){var i,o,s,r=e.props.current,l=e.props.initial,c=r.date,d=r.elapsedTime,u=l.cycleCountLimit,g=l.cycleDuration,m=l.cycleIsReversed,h=l.cycleIsSmooth,f=l.cycleTimeUnit,p=l.rotationMax,v=l.rotationMin,w=l.rotationOffset,y=l._rotationRange;if("countdown_minutes"==f)s=6e4,1==h?(i=d,o=g*s):(i=Math.floor(d/s),o=g);else if("countdown_seconds"==f)s=1e3,1==h?(i=d,o=g*s):(i=Math.floor(d/s),o=g);else if("chrono_hours"==f)s=36e5,1==h?(i=d,o=g*s):(i=Math.floor(d/s),o=g);else if("chrono_minutes"==f)s=6e4,1==h?(i=d,o=g*s):(i=Math.floor(d/s),o=g);else if("chrono_seconds"==f)s=1e3,1==h?(i=d,o=g*s):(i=Math.floor(d/s),o=g);else if("moons"==f){var T=a.getTime(),D=c.dateObj.getTime()-T;i=D%=n,o=g*n}else"date"==f?(s=864e5,1==h?(i=c.dateAsMilliseconds,o=g*s):(i=c.date,o=g)):"hours"==f?(s=36e5,1==h?(i=c.hoursAsMilliseconds,o=g*s):(i=c.hours,o=g)):"minutes"==f?(s=6e4,1==h?(i=c.minutesAsMilliseconds,o=g*s):(i=c.minutes,o=g)):"seconds"==f&&(s=1e3,1==h?(i=c.secondsAsMilliseconds,o=g*s):(i=c.seconds,o=g));var C=v+w+i*(y/o);return 1===u?v<p?C>p&&(C=p):C>v+y&&(C=p):C%=360,1==m&&(C=360-C),C}.bind(t),s=function(e,t){var a=e[t];return"day"!=t&&"month"!=t||(a+=1),a}.bind(t),r=function(e,t,a,n,i,o,s){if(this.watch.logger.logInfo('OTW3_movement "'+e+'" fired'),0==this.isSpinning){this.isDisplayingDefaultStaticDate=!1;var r=this.isPaused;l(t);var g={};g.date=t,"displayDate"==n?(this.lastPresentedDateWasDisplayDate=!0,this.millisecondsLateDueToPause=0):this.lastPresentedDateWasDisplayDate=!1,g.ignoreTimezone=this.lastPresentedDateWasDisplayDate,g.ignoreTimeOffsets=this.lastPresentedDateWasDisplayDate,g.ignoreDst=this.lastPresentedDateWasDisplayDate,o&&(g.chronoElapsedTimeToConsider=o),s&&(g.countdownElapsedTimeToConsider=s),"auto"==i&&(i=1==r?"pause":"run"),"run"==i?("spin"==a&&(g.addSpinDurationToTargetDate=!0),g.nextAction=function(){var e=null;e=t?new Date(t.getTime()):new Date,1==g.addSpinDurationToTargetDate&&e.setMilliseconds(e.getMilliseconds()-this.defaultSpinDuration),l(e),u({ignoreTimezone:this.lastPresentedDateWasDisplayDate,ignoreTimeOffsets:this.lastPresentedDateWasDisplayDate,ignoreDst:this.lastPresentedDateWasDisplayDate})}.bind(this)):g.nextAction=function(){1==this.willBeDisplayingDefaultStaticDate&&(this.willBeDisplayingDefaultStaticDate=!1,this.isDisplayingDefaultStaticDate=!0),l(t)}.bind(this);var m=this.watch.toolbox.getCloneOf(this.watch.layers),h=this.watch.toolbox.getCloneOf(this.offsetsFor);this.applyStatusToLayers(m,h,g),"spin"==a?(0==this.madeFirstTick&&this.jumpToDefaultStaticDisplayDate(),d(g,m)):c(g,m)}else this.watch.logger.logInfo('OTW3_movement "'+e+'" impossible because it is spinning')}.bind(t);t.jumpToDate=function(e){r("jumpToDate",e,"jump","realDate","auto")},t.jumpToDateAndPause=function(e){r("jumpToDateAndPause",e,"jump","realDate","pause")},t.jumpToDateAndRun=function(e){r("jumpToDateAndRun",e,"jump","realDate","run")},t.jumpToDefaultStaticDisplayDate=function(){t.willBeDisplayingDefaultStaticDate=!0,r("jumpToDefaultStaticDisplayDate",t.defaultStaticDisplayDate,"jump","displayDate","pause",t.defaultStaticChronoElpasedTime,t.defaultStaticCountdownElpasedTime)},t.jumpToDisplayDate=function(e){r("jumpToDisplayDate",e,"jump","displayDate","auto")},t.jumpToDisplayDateAndPause=function(e){r("jumpToDisplayDateAndPause",e,"jump","displayDate","pause")},t.jumpToDisplayDateAndRun=function(e){r("jumpToDisplayDateAndRun",e,"jump","displayDate","run")},t.movementDidTick=function(e){t.watch.eventManager.fireEvent("movementDidTick"),t.madeFirstTick=!0};var l=function(e){e||(e=new Date),this.isPaused=!0,this.lastPauseDate=e,clearInterval(this.ticker)}.bind(t);t.pause=function(){t.watch.logger.logInfo('OTW3_movement "pause" fired'),0==t.isSpinning?0==t.isPaused?(l(),t.watch.logger.logInfo('OTW3_movement "pause" ok')):t.watch.logger.logInfo('OTW3_movement "pause" impossible because it is already paused'):t.watch.logger.logInfo('OTW3_movement "pause" impossible because it is spinning')};var c=function(e,t){this.watch.logger.logInfo('OTW3_movement "performJumpToTargetStatus" fired'),this.watch.layers=t,this.movementDidTick(),e.nextAction&&e.nextAction()}.bind(t);t.performMovementTick=function(e){e||(e={}),e.date||(e.date=new Date),t.applyStatusToLayers(t.watch.layers,t.offsetsFor,e),t.movementDidTick()};var d=function(e,t){cancelAnimationFrame(this.frameAnimator),void 0===e.easingEquation&&(e.easingEquation="easeInOutQuad");var a=60,n=0,o=e.spinDuration/1e3*a;o<=1&&(o=1);var s=null,r=e.spinDuration/o,l=!1,c=!1,d=function(){this.isDisplayingDefaultStaticDate=!1,this.isSpinning=!0,this.frameAnimatorTimeout=setTimeout(function(){for(var a="current",u="easingRange",g="initialRotation",m="nextAction",h="onSpinUpdateMoment",f="props",p="targetFileName",v="targetRotation",w=this.watch,y=w.layers,T=w.renderer,D=T.engine,C=w.toolbox,M=0;M<y.length;M++){var b=y[M],I=b.type,O=b[f],S=O.initial,F=O[a],A=t[M][f][a];if("dynamicContent"==I){l=!0;var k=!1;0==S[h]&&0==n?k=!0:100==S[h]&&Number(n+1)>=o?k=!0:Number(n+1)>=o*(S[h]/100)&&(k=!0),1==k&&(c=!0,F[p]=A[p],F.targetX=A.targetX,F.targetY=A.targetY)}else if("movingContent"==I){void 0!==F[v]&&(A[g]||(A[g]=F[v],A[v]>=A[g]?A[u]=A[v]-A[g]:A[u]=A[v]+(360-A[g]),1==S.cycleIsReversed&&(A[u]=-(360-A[u]))));var N=e.easingEquation,x=C.getEasedValue(N,n,A[g],A[u],o)-F[v];F[v]+=x,F[v]=F[v]%360,i(b)}}this.movementDidTick(),0,n++;var W=!1;if(T&&D&&1==D.hasAtLeastOneMissingImage&&(W=!0),1==W)n--,0,s=null;else if(null==s)s=C.getTimestampForNow();else for(var P=C.getTimestampForNow();P-s>n*r;)n++;n>=o&&1==l&&0==c&&n--,n>=o?(cancelAnimationFrame(this.frameAnimator),this.isPaused=!0,this.isSpinning=!1,e[m]&&e[m]()):void 0!==this.frameAnimator&&(this.frameAnimator=requestAnimationFrame(d.bind(this)))}.bind(this),1e3/a)}.bind(this);d()}.bind(t);t.resetChrono=function(){t.chronoIsStopped=!0,t.chronoStartDate=null,t.chronoTotalElapsedTime=0},t.resetCountdown=function(){t.countdownIsStopped=!0,t.countdownStartDate=null,t.countdownTotalElapsedTime=0},t.resetTimeOffset=function(){t.offsetsFor.fullYear=0,t.offsetsFor.month=0,t.offsetsFor.date=0,t.offsetsFor.hours=0,t.offsetsFor.minutes=0,t.offsetsFor.seconds=0,t.offsetsFor.milliseconds=0};var u=function(e){if(this.isPaused=!1,this.lastPauseDate){var t=new Date;this.millisecondsLateDueToPause+=t-this.lastPauseDate,this.lastPauseDate=null}this.isDisplayingDefaultStaticDate=!1,this.willBeDisplayingDefaultStaticDate=!1,e||1==this.lastPresentedDateWasDisplayDate&&(e={ignoreTimezone:!0,ignoreTimeOffsets:!0,ignoreDst:!0}),this.startTicker(e)}.bind(t);t.run=function(){t.watch.logger.logInfo('OTW3_movement "run" fired'),0==t.isSpinning?1==t.isPaused?(u(),t.watch.logger.logInfo('OTW3_movement "run" ok')):t.watch.logger.logInfo('OTW3_movement "run" impossible because it is already running'):t.watch.logger.logInfo('OTW3_movement "run" impossible because it is spinning')},t.setDefaultStaticChronoElpasedTime=function(e){t.defaultStaticChronoElpasedTime=e},t.setDefaultStaticDisplayDate=function(e){t.defaultStaticDisplayDate=new Date(e.getTime())},t.setNewMoonReferenceDate=function(e){a=new Date(e.getTime())},t.setTimeOffset=function(e,a){t.offsetsFor[e]=a},t.setTimeOffsetFromDate=function(e){var a=new Date;t.setTimeOffset("fullYear",e.getFullYear()-a.getFullYear()),t.setTimeOffset("month",e.getMonth()-a.getMonth()),t.setTimeOffset("date",e.getDate()-a.getDate()),t.setTimeOffset("hours",e.getHours()-a.getHours()),t.setTimeOffset("minutes",e.getMinutes()-a.getMinutes()),t.setTimeOffset("seconds",e.getSeconds()-a.getSeconds()),t.setTimeOffset("milliseconds",e.getMilliseconds()-a.getMilliseconds())},t.setTimeSpeedMultiplier=function(e){1==e?t.timeSpeedMultiplierManipulationStartDate=null:t.timeSpeedMultiplierManipulationStartDate||(t.timeSpeedMultiplierManipulationStartDate=new Date),t.timeSpeedMultiplier=e,t.ticksPerSecond=t.realWorldTicksPerSecond*e,t.ticksPerSecond>60&&(t.ticksPerSecond=60),0==t.isPaused&&(t.pause(),t.run())},t.spinToDate=function(e){r("spinToDate",e,"spin","realDate","auto")},t.spinToDateAndPause=function(e){r("spinToDateAndPause",e,"spin","realDate","pause")},t.spinToDateAndRun=function(e){r("spinToDateAndRun",e,"spin","realDate","run")},t.spinToDefaultStaticDisplayDate=function(){t.willBeDisplayingDefaultStaticDate=!0,r("spinToDefaultStaticDisplayDate",t.defaultStaticDisplayDate,"spin","displayDate","pause",t.defaultStaticChronoElpasedTime,t.defaultStaticCountdownElpasedTime)},t.spinToDisplayDate=function(e){r("spinToDisplayDate",e,"spin","displayDate","auto")},t.spinToDisplayDateAndPause=function(e){r("spinToDisplayDateAndPause",e,"spin","displayDate","pause")},t.spinToDisplayDateAndRun=function(e){r("spinToDisplayDateAndRun",e,"spin","displayDate","run")},t.startChrono=function(){t.chronoIsStopped=!1,t.chronoStartDate=new Date},t.startCountdown=function(){t.countdownIsStopped=!1,t.countdownStartDate=new Date},t.startTicker=function(e){void 0!==t.ticker&&(clearInterval(t.ticker),t.ticker=setInterval(function(e){e&&e.date&&delete e.date,this.performMovementTick(e)}.bind(t,e),1e3/this.ticksPerSecond))},t.stopChrono=function(){if(t.watch.logger.logInfo('OTW3_movement "stopChrono" fired'),0==t.chronoIsStopped){t.chronoIsStopped=!0;var e=new Date;t.chronoTotalElapsedTime+=e.getTime()-t.chronoStartDate.getTime(),t.watch.logger.logInfo('OTW3_movement "stopChrono" ok')}else t.watch.logger.logInfo('OTW3_movement "stopChrono" impossible because it is already paused')},t.stopCountdown=function(){if(t.watch.logger.logInfo('OTW3_movement "stopCountdown" fired'),0==t.countdownIsStopped){t.countdownIsStopped=!0;var e=new Date;t.countdownTotalElapsedTime+=e.getTime()-t.countdownStartDate.getTime(),t.watch.logger.logInfo('OTW3_movement "stopCountdown" ok')}else t.watch.logger.logInfo('OTW3_movement "stopCountdown" impossible because it is already paused')},t.resetTimeOffset()}function OTW3_canvasRendererEngine(e){var t=this;t.renderer=e.renderer,t.watch=e.renderer.watch,t.assetManager=this.watch.assetManager,t.rendererTimer=null,t.scaleX=1,t.scaleY=1,t.previousScaleX=1,t.previousScaley=1,t.antiAliasingAmount=1,t.hasAtLeastOneMissingImage=!1,t.originalWidth=0,t.originalHeight=0,t.overallWidth=0,t.overallHeight=0,t.overallWidthWithUnit,t.overallHeightWithUnit,t.globalContainer=document.createElement("DIV"),t.globalContainer.setAttribute("id","OTW_globalContainer_"+t.watch.id),t.globalContainer.style.position="relative",t.backgroundHolder,t.offscreenCanvas=document.createElement("CANVAS"),t.offscreenCanvasContext=null,t.onscreenCanvas=document.createElement("CANVAS"),t.onscreenCanvas.setAttribute("id","OTW_mainTimepiece_"+t.watch.id),t.onscreenCanvas.style.left="0px",t.onscreenCanvas.style.top="0px",t.onscreenCanvas.style.position="absolute",t.onscreenCanvas.style.transform="scale("+1/t.scaleX+", "+1/t.scaleY+")",t.onscreenCanvasContext=t.onscreenCanvas.getContext("2d"),t.globalContainer.appendChild(t.onscreenCanvas),t.displacementMapCanvas=null,t.displacementMapCanvasContext=null,t.displacementMapImageData=null,t.die=function(){t.getFrameForLayers=function(){},clearTimeout(t.rendererTimer),t.rendererTimer=null,delete t.rendererTimer,t.renderer=null,delete t.renderer,t.watch=null,delete t.watch,t.assetManager=null,delete t.assetManager},t.setTargetElement=function(e){t.targetElement=e,t.targetElement.appendChild(t.globalContainer)},t.setAntiAliasingAmount=function(e){t.antiAliasingAmount=e,t.setScale(t.scaleX,t.scaleY)},t.setScale=function(e,n){e*t.antiAliasingAmount==t.previousScaleX&&n*t.antiAliasingAmount==t.previousScaleY||(t.scaleX=e*t.antiAliasingAmount,t.scaleY=n*t.antiAliasingAmount,t.previousScaleX=t.scaleX,t.previousScaleY=t.scaleY,a(),t.getFrameForCurrentLayers())};var a=function(e,t){0==this.originalWidth&&(this.originalWidth=e),0==this.originalHeight&&(this.originalHeight=t),this.overallWidth=Math.round(this.originalWidth*this.scaleX),this.overallHeight=Math.round(this.originalHeight*this.scaleY),this.overallWidthWithUnit=this.overallWidth+"px",this.overallHeightWithUnit=this.overallHeight+"px",o()}.bind(t),n=function(e){e&&(i(e,this.overallWidth,this.overallHeight),i(e.style,this.overallWidthWithUnit,this.overallHeightWithUnit))}.bind(t),i=function(e,t,a){(e instanceof HTMLCanvasElement||e instanceof HTMLDivElement)&&(0==e.hasAttribute("width")&&e.setAttribute("width",t),0==e.hasAttribute("height")&&e.setAttribute("height",a)),e.width!=t&&(e.width=t),e.height!=a&&(e.height=a)}.bind(t),o=function(){this.overallWidth>0&&this.overallHeight>0&&(n(this.globalContainer),n(this.offscreenCanvas),n(this.onscreenCanvas),n(this.backgroundHolder))}.bind(t);t.createBackgroundHolder=function(){var e=document.createElement("DIV"),a=e.style;e.setAttribute("id","OTW_backgroundImageView_"+t.watch.id),a.left="0px",a.top="0px",a.position="absolute",a.backgroundSize="cover",a.backgroundRepeat="no-repeat",t.backgroundHolder=e,t.globalContainer.insertBefore(t.backgroundHolder,t.onscreenCanvas)};var s=function(e){for(var t=[],a=-1,n=null,i=null,o=0;o<e.length;o++){if("drawImage"==(c=(l=e[o]).action))t.push(l);else if("endMask"==c){var s=!1;o<e.length-1&&"startMask"==e[o+1].action&&e[o+1].imgFileName==n&&e[o+1].maskMode==i&&(s=!0,o++),0==s&&t.push(l)}else if("globalAlpha"==c)t.push(l);else if("resetTransform"==c)t.push(l);else if("restore"==c){if(o<e.length-1&&a>-1){for(var r=o;r>=a;r--)"rotate"==e[r].action?t.push({action:"rotate",angleInDegrees:-e[r].angleInDegrees}):"transform"==e[r].action?t.push({action:"resetTransform"}):"translate"==e[r].action&&t.push({action:"translate",x:-e[r].x,y:-e[r].y});a=-1}}else"rotate"==c?t.push(l):"save"==c?a=o:"setTransform"==c?t.push(l):"startMask"==c?(n=l.imgFileName,i=l.maskMode,t.push(l)):"startMovingMask"==c?(n=l.imgFileName,i=l.maskMode,t.push(l)):"transform"==c?t.push(l):"translate"==c&&t.push(l)}for(o=0;o<t.length-1;o++){var l,c;if("drawImage"!=(c=(l=t[o]).action)){var d=t[o+1];if(c==d.action)if("rotate"==c){var u=l.angleInDegrees+d.angleInDegrees;t.splice(o+1,1),0==u?(t.splice(o,1),o--):l.angleInDegrees=u}else if("translate"==c){var g=l.x+d.x,m=l.y+d.y;t.splice(o+1,1),0==g&&0==m?(t.splice(o,1),o--):(l.x=g,l.y=m)}}}return t},r=function(e,t){for(var a=0;a<t.length;a++){var n=t[a],i=n.action;if("drawImage"==i)e.drawImage(n.img,n.x,n.y,n.img.naturalWidth*this.scaleX,n.img.naturalHeight*this.scaleY);else if("endMask"==i)console.log('should not be unsing step of type "endMask"');else if("globalAlpha"==i)e.globalAlpha=n.num;else if("resetTransform"==i)e.setTransform(1,0,0,1,0,0);else if("restore"==i)console.log('should not be unsing step of type "restore"'),e.restore();else if("rotate"==i)e.rotate(this.watch.toolbox.degreesToRadians(n.angleInDegrees));else if("save"==i)console.log('should not be unsing step of type "save"');else if("setTransform"==i)e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f);else if("startMask"==i){var o=e.canvas.width,s=e.canvas.height;(g=document.createElement("CANVAS")).setAttribute("width",o),g.setAttribute("height",s);for(var l=g.getContext("2d"),c=[],d=0,u=a+1;u<t.length;u++){if("startMask"==(h=(m=t[u]).action))d++,c.push(m);else if("endMask"==h){if(0==d)break;d--,c.push(m)}else c.push(m)}r(l,c),"drawOverTransparent"==n.maskMode?l.globalCompositeOperation="destination-out":l.globalCompositeOperation="destination-in",l.setTransform(1,0,0,1,0,0),l.drawImage(n.img,n.x,n.y),e.drawImage(g,0,0,o,s,0,0,o,s),a+=c.length+1}else if("startMovingMask"==i){var g;o=n.img.width,s=n.img.height;(g=document.createElement("CANVAS")).setAttribute("width",o),g.setAttribute("height",s);for(l=g.getContext("2d"),c=[],d=0,u=a+1;u<t.length;u++){var m,h;if("startMovingMask"==(h=(m=t[u]).action))d++,c.push(m);else if("endMask"==h){if(0==d)break;d--,c.push(m)}else c.push(m)}r(l,c),"drawOverTransparent"==n.maskMode?l.globalCompositeOperation="destination-out":l.globalCompositeOperation="destination-in",l.setTransform(1,0,0,1,0,0),l.drawImage(n.img,n.x,n.y),e.drawImage(g,0,0,o,s,0,0,o,s),a+=c.length+1}else"transform"==i?e.transform(n.a,n.b,n.c,n.d,n.e,n.f):"translate"==i&&e.translate(n.x*this.scaleX,n.y*this.scaleY)}}.bind(t);t.getOffscreenCanvasesWithAppliedReceipe=function(e,a,n){var i=n[1].props.initial,o=n[0].props.initial.imageFolderName,s=null,l=null,c=0,d=0,u=null,g=[],m=document.createElement("CANVAS"),h=m.getContext("2d");if(m.setAttribute("width",t.overallWidth),m.setAttribute("height",t.overallHeight),r(h,e),1==t.watch.hasCyclop&&(c=i.cyclopX,d=i.cyclopY,s=t.assetManager.getImage({imageFolderName:o,fileName:i.fileName}),null!=i.maskFileName&&(u=i._maskBounds,(l=t.assetManager.getImage({imageFolderName:o,fileName:i.maskFileName}))&&(h.globalCompositeOperation="destination-out",h.setTransform(1,0,0,1,0,0),h.drawImage(l,0,0))),null!=i.displacementMapFileName)){var f=n[0].props.initial,p=f.timepieceCenterX,v=f.timepieceCenterY,w=i.timepieceOffsetX,y=i.timepieceOffsetY,T=i.zoomCoef,D=i._displacementMapBounds,C=i.displacementMapDriftRangeX,M=i.displacementMapDriftRangeY,b=document.createElement("canvas");b.setAttribute("width",D.width),b.setAttribute("height",D.height);var I=b.getContext("2d"),O=(p-w)*T-(p-w)+D.x,S=(v-y)*T-(v-y)+D.y;I.translate(-O,-S),I.scale(T,T),I.imageSmoothingQuality="high",I.drawImage(m,0,0),I.setTransform(1,0,0,1,0,0);var F=h.getImageData(0,0,t.overallWidth,t.overallHeight).data,A=I.getImageData(0,0,D.width,D.height).data;if(!t.displacementMapCanvas){var k=t.assetManager.getImage({imageFolderName:o,fileName:i.displacementMapFileName});k&&(t.displacementMapCanvas=document.createElement("canvas"),t.displacementMapCanvas.setAttribute("width",D.width),t.displacementMapCanvas.setAttribute("height",D.height),t.displacementMapCanvasContext=t.displacementMapCanvas.getContext("2d"),t.displacementMapCanvasContext.drawImage(k,D.x,D.y,D.width,D.height,0,0,D.width,D.height),t.displacementMapImageData=t.displacementMapCanvasContext.getImageData(0,0,D.width,D.height).data)}var N=document.createElement("canvas");N.setAttribute("width",D.width),N.setAttribute("height",D.height);for(var x=N.getContext("2d").createImageData(D.width,D.height),W=C,P=M,E=0;E<D.height;E++)for(var R=0;R<D.width;R++){var _=4*(E*D.width+R),Y=t.displacementMapImageData[_]/255,X=t.displacementMapImageData[_+3]/255,L=Math.round(R+W*Y),j=Math.round(E+P*Y);L<0&&(L=0),L>D.width-1&&(L=D.width-1),j<0&&(j=0),j>D.height-1&&(j=D.height-1);var U=4*(E*D.width+R+t.overallWidth*D.y+(E+1)*D.x+E*(t.overallWidth-D.x-D.width)),H=4*(j*D.width+L);0==X?(x.data[_]=F[U],x.data[_+1]=F[U+1],x.data[_+2]=F[U+2],x.data[_+3]=F[U+3]):(x.data[_]=A[H],x.data[_+1]=A[H+1],x.data[_+2]=A[H+2],x.data[_+3]=A[H+3])}h.putImageData(x,D.x,D.y)}if(g.push({canvas:m,x:0,y:0,width:t.overallWidth,height:t.overallHeight}),1==t.watch.hasCyclop){if(null!=i.maskFileName&&a){var B=t.overallWidth,V=t.overallHeight,z=0,J=0;null!=u&&(B=u.width,V=u.height,z=u.x,J=u.y);var q=document.createElement("CANVAS"),Q=q.getContext("2d");q.setAttribute("width",B),q.setAttribute("height",V),r(Q,a),l&&(Q.globalCompositeOperation="destination-in",Q.setTransform(1,0,0,1,0,0),Q.drawImage(l,-z,-J)),g.push({canvas:q,x:z,y:J,width:B,height:V})}if(s){var G=s.width,K=s.height,Z=document.createElement("CANVAS"),$=Z.getContext("2d");Z.setAttribute("width",G),Z.setAttribute("height",K),$.drawImage(s,0,0),g.push({canvas:Z,x:c,y:d,width:G,height:K})}}return g},t.applyRenderingReceipeToCanvasContext=function(e,a,n,i){var o=t.getOffscreenCanvasesWithAppliedReceipe(e,a,n);i.clearRect(0,0,this.overallWidth,this.overallHeight);for(var s=0;s<o.length;s++){var r=o[s],l=r.canvas,c=r.width,d=r.height,u=r.x,g=r.y;i.drawImage(l,0,0,c,d,u,g,c,d)}},t.applyRenderingReceipeToCanvasContext_ALT=function(e,a,n,i){var o=t.getOffscreenCanvasesWithAppliedReceipe(e,a,n),s=document.createElement("CANVAS"),r=s.getContext("2d");s.setAttribute("width",t.overallWidth),s.setAttribute("height",t.overallHeight);for(var l=0;l<o.length;l++){var c=o[l],d=c.canvas,u=c.width,g=c.height,m=c.x,h=c.y;r.drawImage(d,0,0,u,g,m,h,u,g)}var f=r.getImageData(0,0,t.overallWidth,t.overallHeight);i.clearRect(0,0,t.overallWidth,t.overallHeight),i.putImageData(f,0,0)},t.getFrameForCurrentLayers=function(){t.getFrameForLayers(t.watch.layers)},t.getReceipeForLayersInCyclopMode=function(e,n){var i=!1,o=e[0].props.initial,s=o.baseRotation,r=o.imageFolderName,l=o.scaleX,c=o.scaleY,d=o.skewX,u=o.skewY,g=o.timepieceCenterX,m=o.timepieceCenterY,h={},f=1,p=0,v=0,w=null,y=null,T=null,D=null,C=0,M=0,b=null,I=null;if(1==t.watch.hasCyclop){var O=e[1].props.initial;w=O.fileName,y=O.maskFileName,b=O.displacementMapFileName,y&&((T=t.assetManager.getImage({imageFolderName:r,fileName:y}))?(null==O._maskBounds&&(i=!0,O._maskBounds=t.watch.toolbox.getContentBounds(T)),D=O._maskBounds):i=!0),b&&(I=t.assetManager.getImage({imageFolderName:r,fileName:b}))&&(null==O._displacementMapBounds&&(i=!0,O._displacementMapBounds=t.watch.toolbox.getContentBounds(I)),O._displacementMapBounds),1==n&&(O.cyclopX,O.cyclopY,p=O.timepieceOffsetX,v=O.timepieceOffsetY,f=O.zoomCoef,null!=D&&(C=D.x,M=D.y))}for(var S={},F=0;F<e.length;F++){var A=(x=e[F]).type,k=x.props.initial;"movingContent"==A&&k.id&&(S[k.id]=x)}var N=[];for(F=0;F<e.length;F++){A=(x=e[F]).type,k=x.props.initial;var x,W=x.props.current,P=k.effectOfCyclop,E=k.isOptional,R=f,_=p,Y=v;if("none"==P&&(R=1,_=0,Y=0),"timepieceCenter"==A)h[k.id]={x:k.x,y:k.y};else if(0==n&&"newWatch"==A){var X=k.backgroundFileName;if(X){if(t.backgroundHolder||t.createBackgroundHolder(),J=t.assetManager.getImage({imageFolderName:r,fileName:X})){var L="url("+t.assetManager.imagesByFolderName[r][X].src+")";t.backgroundHolder.style.backgroundImage!=L&&(t.backgroundHolder.style.backgroundImage=L,a(J.width,J.height))}else i=!0}else{var j=k.width,U=k.height;j>0&&U>0?a(j,U):this.watch.logger.logWarning("OTW3 has no size: not given in arguments, nor with an image")}}else if("staticContent"==A&&1==this.renderer.renderStaticContents){var H=!0;if(1==n&&"hide"==P&&(H=!1),1==H)(J=this.assetManager.getImage({imageFolderName:r,fileName:k.fileName}))?(N.push({action:"resetTransform"}),N.push({action:"drawImage",img:J,x:k.x-C,y:k.y-M})):i=!0}else if("dynamicContent"==A&&1==this.renderer.renderDynamicContents){H=!0;if(1==n&&"hide"==P&&(H=!1),1==H)(J=this.assetManager.getImage({imageFolderName:r,fileName:W.targetFileName}))?(N.push({action:"resetTransform"}),N.push({action:"drawImage",img:J,x:W.targetX-C,y:W.targetY-M})):i=!0}else if("movingContent"==A&&1==this.renderer.renderMovingContents){H=!0;if(1==n&&"hide"==P&&(H=!1),1==E&&1==this.watch.hasPoorPerformances&&(H=!1),1==H){var B=k.scaleX;0==B&&(B=l),B*=R;var V=k.scaleY;0==V&&(V=c),V*=R;var z=k.skewX;0==z&&(z=d);var J,q=k.skewY;if(0==q&&(q=u),J=this.assetManager.getImage({imageFolderName:r,fileName:k.fileName})){var Q=null;k.maskFileName&&(Q=this.assetManager.getImage({imageFolderName:r,fileName:k.maskFileName}));var G=null;k.maskedById&&S[k.maskedById]&&(G=S[k.maskedById]);var K,Z,$=k.timepieceCenterId;$?h[$]?(K=h[$].x,Z=h[$].y):(t.watch.logger.logWarning('OTW3 could not find timepieceCenterId "'+$+'". Falling back to default center'),K=g,Z=m):(K=g,Z=m),1==t.watch.isTransitionalFromCodeVersion2&&N.push({action:"save"}),Q&&(N.push({action:"resetTransform"}),N.push({action:"startMask",img:Q,x:-C,y:-M,imgFileName:k.maskFileName,maskMode:k.maskMode}));var ee=0,te=0,ae=0;if(G){var ne=t.watch.toolbox.getCloneOf(G),ie=ne.props.initial,oe=ne.props.current;delete ie.visualEffect,delete oe.visualEffect;var se=[];se.push(e[0]),1==n&&(se.push(e[1]),2),ie.isMaskOnly=!1,se.push(ne);var re=t.getReceipeForLayersInCyclopMode(se,n);ee=oe.targetRotation;var le=t.watch.toolbox.degreesToRadians(-ee),ce=1/(B/100),de=1/(V/100),ue=Math.cos(le),ge=Math.sin(le),me=(ie.offsetX-k.offsetX)*ce,he=(ie.offsetY-k.offsetY)*de;if(te=ie.anchorPointX-(me*ue-he*ge),ae=ie.anchorPointY-(me*ge+he*ue),re)for(var fe=0;fe<re.length;fe++){var pe=re[fe];"drawImage"==pe.action?(N.push({action:"translate",x:pe.x,y:pe.y}),N.push({action:"startMovingMask",img:pe.img,x:0,y:0,imgFileName:"bla",maskMode:k.maskMode})):N.push(pe)}}for(var ve,we=W.targetRotation+s-ee;we<0;)we+=360;if(we%=360,1==t.watch.isTransitionalFromCodeVersion2)N.push({action:"transform",a:B/100,b:z,c:q,d:V/100,e:K+_+k.offsetX-C,f:Z+Y+k.offsetY-M}),N.push({action:"rotate",angleInDegrees:we});else G||(ve=t.watch.toolbox.getTransformObject((K+_+k.offsetX-C)*this.scaleX,(Z+Y+k.offsetY-M)*this.scaleY,we,B/100,V/100,z,q),N.push(ve));if(G?(N.push({action:"translate",x:te-ie.maskedContentAnchorPointX,y:ae-ie.maskedContentAnchorPointY}),N.push({action:"rotate",angleInDegrees:we}),N.push({action:"drawImage",img:J,x:-k.anchorPointX,y:-k.anchorPointY})):0==k.isMaskOnly&&N.push({action:"drawImage",img:J,x:-k.anchorPointX*this.scaleX,y:-k.anchorPointY*this.scaleY}),k.visualEffect&&1==this.renderer.renderVisualEffects&&"overlayOpacityForRotation"==k.visualEffect.type)for(var ye=0;ye<k.visualEffect.elements.length;ye++){var Te=k.visualEffect.elements[ye],De=W.visualEffect.elements[ye],Ce=t.assetManager.getImage({imageFolderName:r,fileName:Te._fileName});Ce?1==De.rotationIsInRange&&(N.push({action:"globalAlpha",num:De.targetOpacity}),N.push({action:"drawImage",img:Ce,x:-k.anchorPointX,y:-k.anchorPointY}),N.push({action:"globalAlpha",num:1})):i=!0}(Q||G)&&N.push({action:"endMask"}),1==t.watch.isTransitionalFromCodeVersion2&&N.push({action:"restore"})}else i=!0}}}1==t.watch.hasCyclop&&(null!=w&&((J=t.assetManager.getImage({imageFolderName:r,fileName:w}))||(i=!0)));return 1==i?(t.hasAtLeastOneMissingImage=!0,null):(t.hasAtLeastOneMissingImage=!1,N)},t.getCompleteOutputDataForLayers=function(e){var a=t.getReceipeForLayersInCyclopMode(e,!1),n=null,i=null,o=null;return a&&(i=1==this.renderer.optimizeRenderingReceipes?s(a):a,1==t.watch.hasCyclop&&null!=(n=t.getReceipeForLayersInCyclopMode(e,!0))&&(o=1==this.renderer.optimizeRenderingReceipes?s(n):n)),{receipeForRegularTimepiece:i,receipeForMagnifiedTimepiece:o,layers:e}},t.maxCountOfAttemptToLoadMissingImages=1e3,t.countOfAttemptToLoadMissingImages=0,t.getFrameForLayers=function(e){t.getFrameForLayersInCanvasMode(e)},t.getFrameForLayersInCanvasMode=function(e){var a=t.getCompleteOutputDataForLayers(e),n=!0;1==t.watch.hasCyclop&&null==a.receipeForMagnifiedTimepiece&&(n=!1),null==a.receipeForRegularTimepiece&&(n=!1),1==n?(t.countOfAttemptToLoadMissingImages>0&&(t.watch.logger.logInfo('OTW3_canvasRendererEngine "getFrameForLayersInCanvasMode" has now all images after '+t.countOfAttemptToLoadMissingImages+" attempt(s), ok to render."),t.countOfAttemptToLoadMissingImages=0),t.applyRenderingReceipeToCanvasContext(a.receipeForRegularTimepiece,a.receipeForMagnifiedTimepiece,a.layers,t.onscreenCanvasContext),t.watch.eventManager.fireEvent("firstTimeRendered")):1==t.watch.movement.isPaused&&(0==t.countOfAttemptToLoadMissingImages&&t.watch.logger.logInfo('OTW3_canvasRendererEngine "getFrameForLayersInCanvasMode" an image is missing, and since the movement is paused, will try again every 5 millisec '+t.maxCountOfAttemptToLoadMissingImages+" times to force image to appear"),t.countOfAttemptToLoadMissingImages>=t.maxCountOfAttemptToLoadMissingImages?t.watch.logger.logInfo('OTW3_canvasRendererEngine "getFrameForLayersInCanvasMode" an image is still missing, even after '+t.maxCountOfAttemptToLoadMissingImages+" tries to force image to appear"):(t.countOfAttemptToLoadMissingImages++,t.rendererTimer=setTimeout(this.getFrameForLayers.bind(this,e),5)))}}function OTW3_cssRendererEngine(e){var t=this;t.renderer=e.renderer,t.watch=e.renderer.watch,t.assetManager=t.watch.assetManager,t.overallWidth=0,t.overallHeight=0,t.overallWidthWithUnit,t.overallHeightWithUnit,t.renderAsFlatStructureWithContainerForEachElement=!1,t.cyclopImageMaskInvertedAsDataUrl=null,t.invertedMaskDataUrlForUrl={},t.die=function(){t.getFrameForLayers=function(){},t.renderer=null,delete t.renderer,t.watch=null,delete t.watch,t.assetManager=null,delete t.assetManager},t.setTargetElement=function(e){t.targetElement=e};var a=function(e,t){this.overallWidth=e,this.overallHeight=t,this.overallWidthWithUnit=this.overallWidth+"px",this.overallHeightWithUnit=this.overallHeight+"px"}.bind(t);t.getFrameForCurrentLayers=function(){t.getFrameForLayers(t.watch.layers)},t.cachedDivs={},t.getDivMatchingProps=function(e){var a;if(a=e.id?e.id:e._internalId+"***"+e.src+"***"+e.width+"***"+e.height+"***"+e.x+"***"+e.y,!t.cachedDivs[a]){var n=document.createElement("DIV");e.position?n.style.position=e.position:n.style.position="absolute",n.setAttribute("width",e.width),n.setAttribute("height",e.height),n.style.width=e.width+"px",n.style.height=e.height+"px",n.style.left=e.x+"px",n.style.top=e.y+"px",e.src&&(n.style.backgroundImage="url("+e.src+")"),e.id&&n.setAttribute("id",e.id),e.maskSrc&&(n.style.webkitMaskImage="url("+e.maskSrc+")"),e.maskComposite&&(n.style.webkitMaskComposite=e.maskComposite),e.maskX&&(n.style.webkitMaskPositionX=e.maskX+"px"),e.maskY&&(n.style.webkitMaskPositionY=e.maskY+"px"),t.cachedDivs[a]=n}return t.cachedDivs[a]},t.cachedMaskedDivs={},t.getMaskedDivMatchingProps=function(e){var a;if(a=e.id?e.id:e._internalId+"***"+e.src+"***"+e.width+"***"+e.height+"***"+e.x+"***"+e.y+"***"+e.y+"***"+e.maskMode,!this.cachedMaskedDivs[a]){var n=document.createElement("DIV");e.position?n.style.position=e.position:n.style.position="absolute",n.setAttribute("width",e.width),n.setAttribute("height",e.height),n.style.width=e.width+"px",n.style.height=e.height+"px",n.style.left=e.x+"px",n.style.top=e.y+"px",n.style.webkitMaskComposite="source-out","drawOverTransparent"==e.maskMode?(null==t.invertedMaskDataUrlForUrl[e.src]&&(t.invertedMaskDataUrlForUrl[e.src]=t.watch.toolbox.getInvertedAlphaDataUrlFromImage(e.img)),n.style.webkitMaskImage="url("+t.invertedMaskDataUrlForUrl[e.src]+")"):n.style.webkitMaskImage="url("+e.src+")",e.id&&n.setAttribute("id",e.id),this.cachedMaskedDivs[a]=n}return this.cachedMaskedDivs[a]},t.getDivsForReceipe=function(e,a){var n="";1==a&&(n="_underCyclop");for(var i=[],o=null,s=0;s<e.length;s++){var r=e[s],l=r.action;if("drawImage"==l){var c=t.assetManager.getImage({imageFolderName:r.imageFolderName,fileName:r.fileName}),d=t.getDivMatchingProps({_internalId:r._internalId,src:c.src,width:c.width,height:c.height,x:r.x,y:r.y});void 0!==r.opacity&&(d.style.opacity=r.opacity),void 0!==r.anchorPointX&&(d.style.transform="scale("+r.scaleX+", "+r.scaleY+") skew("+r.skewX+"rad, "+r.skewY+"rad) rotate("+this.watch.toolbox.degreesToRadians(r.angleInDegrees)+"rad)",d.style.transformOrigin=r.anchorPointX+"px "+r.anchorPointY+"px"),o?o.appendChild(d):i.push(d)}else if("endMask"==l)i.push(u),o=null;else if("startMask"==l){if(c=t.assetManager.getImage({imageFolderName:r.imageFolderName,fileName:r.imgFileName}))o=u=t.getMaskedDivMatchingProps({_internalId:r._internalId,src:c.src,img:c,width:c.width,height:c.height,x:r.x,y:r.y,maskMode:r.maskMode})}else if("startMovingMask"==l){c=t.assetManager.getImage({imageFolderName:r.imageFolderName,fileName:r.fileName});var u=t.getDivMatchingProps({id:"div_"+s+n,src:null,width:c.width,height:c.height,x:r.x,y:r.y,maskSrc:c.src,maskComposite:"source-out"});t.watch.toolbox.removeAllChildrenFromNode(u),void 0!==r.anchorPointX&&(u.style.transform="scale("+r.scaleX+", "+r.scaleY+") skew("+r.skewX+"rad, "+r.skewY+"rad) rotate("+this.watch.toolbox.degreesToRadians(r.angleInDegrees)+"rad)",u.style.transformOrigin=r.anchorPointX+"px "+r.anchorPointY+"px"),o=u}}return i},t.applyRenderingReceipeToDiv=function(e,a,n,i){var o=t.getDivMatchingProps({id:"OTW_globalContainer_"+t.watch.id,src:null,width:t.overallWidth,height:t.overallHeight,position:"relative"}),s=n[0].props.initial,r=s.backgroundFileName,l=s.imageFolderName;if(r&&t.assetManager.getImage({imageFolderName:l,fileName:r})){var c="url("+t.assetManager.imagesByFolderName[l][r].src+")";o.style.backgroundImage!=c&&(o.style.backgroundImage=c)}if(1==t.watch.hasCyclop){var d=n[1].props.initial,u=d.fileName,g=t.assetManager.getImage({imageFolderName:l,fileName:u}),m=t.assetManager.getImage({imageFolderName:l,fileName:d.maskFileName}),h=g.width,f=g.height,p=d._maskBounds,v=d.cyclopX,w=d.cyclopY;if(null==t.cyclopImageMaskInvertedAsDataUrl&&(t.cyclopImageMaskInvertedAsDataUrl=t.watch.toolbox.getInvertedAlphaDataUrlFromImage(m)),1==t.renderAsFlatStructureWithContainerForEachElement){t.watch.toolbox.removeAllChildrenFromNode(o);for(var y=t.getDivsForReceipe(e,!1),T=0;T<y.length;T++){var D=t.getDivMatchingProps({id:"OTW_individualContainer_"+t.watch.id+"_regular_"+T,src:null,width:t.overallWidth,height:t.overallHeight,x:0,y:0,maskSrc:t.cyclopImageMaskInvertedAsDataUrl,maskComposite:"source-out"});t.watch.toolbox.removeAllChildrenFromNode(D),D.appendChild(y[T]),o.appendChild(D)}var C=t.getDivsForReceipe(a,!0);for(T=0;T<C.length;T++){D=t.getDivMatchingProps({id:"OTW_individualContainer_"+t.watch.id+"_magnified_"+T,src:null,width:p.width,height:p.height,x:p.x,y:p.y,maskSrc:m.src,maskComposite:"source-out",maskX:-p.x,maskY:-p.y});t.watch.toolbox.removeAllChildrenFromNode(D),D.appendChild(C[T]),o.appendChild(D)}D=t.getDivMatchingProps({id:"OTW_individualContainer_"+t.watch.id+"_cyclop",src:null,width:t.overallWidth,height:t.overallHeight,x:0,y:0});t.watch.toolbox.removeAllChildrenFromNode(D);var M=t.getDivMatchingProps({id:"OTW_cyclopContainer_"+t.watch.id,src:g.src,width:h,height:f,x:v,y:w});D.appendChild(M),o.appendChild(D)}else{var b=t.getDivMatchingProps({id:"OTW_regularTimepieceContainer_"+t.watch.id,src:null,width:t.overallWidth,height:t.overallHeight,x:0,y:0,maskSrc:t.cyclopImageMaskInvertedAsDataUrl,maskComposite:"source-out"});t.watch.toolbox.removeAllChildrenFromNode(b);for(y=t.getDivsForReceipe(e,!1),T=0;T<y.length;T++)b.appendChild(y[T]);b.parentNode||o.appendChild(b);var I=t.getDivMatchingProps({id:"OTW_magnifiedTimepieceContainer_"+t.watch.id,src:null,width:p.width,height:p.height,x:p.x,y:p.y,maskSrc:m.src,maskComposite:"source-out",maskX:-p.x,maskY:-p.y});t.watch.toolbox.removeAllChildrenFromNode(I);for(C=t.getDivsForReceipe(a,!0),T=0;T<C.length;T++)I.appendChild(C[T]);I.parentNode||o.appendChild(I),(M=t.getDivMatchingProps({id:"OTW_cyclopContainer_"+t.watch.id,src:g.src,width:h,height:f,x:v,y:w})).parentNode||o.appendChild(M)}}else{y=t.getDivsForReceipe(e,!1);if(t.watch.toolbox.removeAllChildrenFromNode(o),1==t.renderAsFlatStructureWithContainerForEachElement)for(T=0;T<y.length;T++){D=t.getDivMatchingProps({id:"OTW_individualContainer_"+t.watch.id+"_"+T,src:null,width:t.overallWidth,height:t.overallHeight,x:0,y:0});t.watch.toolbox.removeAllChildrenFromNode(D),D.appendChild(y[T]),o.appendChild(D)}else for(T=0;T<y.length;T++)o.appendChild(y[T])}o.parentNode||i&&i.appendChild(o)},t.getCompleteOutputDataForLayers=function(e){var a=t.getReceipeForLayersInCyclopMode(e,!1),n=null;return a&&1==t.watch.hasCyclop&&(n=t.getReceipeForLayersInCyclopMode(e,!0)),{receipeForRegularTimepiece:a,receipeForMagnifiedTimepiece:n,layers:e}},t.maxCountOfAttemptToLoadMissingImages=1e3,t.countOfAttemptToLoadMissingImages=0,t.getFrameForLayers=function(e){var a=t.getCompleteOutputDataForLayers(e),n=!0;1==t.watch.hasCyclop&&null==a.receipeForMagnifiedTimepiece&&(n=!1),null==a.receipeForRegularTimepiece&&(n=!1),1==n?(t.countOfAttemptToLoadMissingImages>0&&(t.watch.logger.logInfo('OTW3_cssRendererEngine "getFrameForLayers" has now all images after '+t.countOfAttemptToLoadMissingImages+" attempt(s), ok to render."),t.countOfAttemptToLoadMissingImages=0),t.applyRenderingReceipeToDiv(a.receipeForRegularTimepiece,a.receipeForMagnifiedTimepiece,a.layers,t.targetElement),t.watch.eventManager.fireEvent("firstTimeRendered")):1==t.watch.movement.isPaused&&(0==t.countOfAttemptToLoadMissingImages&&t.watch.logger.logInfo('OTW3_cssRendererEngine "getFrameForLayers" an image is missing, and since the movement is paused, will try again every 5 millisec '+t.maxCountOfAttemptToLoadMissingImages+" times to force image to appear"),t.countOfAttemptToLoadMissingImages>=t.maxCountOfAttemptToLoadMissingImages?t.watch.logger.logInfo('OTW3_cssRendererEngine "getFrameForLayers" an image is still missing, even after '+t.maxCountOfAttemptToLoadMissingImages+" tries to force image to appear"):(t.countOfAttemptToLoadMissingImages++,t.rendererTimer=setTimeout(this.getFrameForLayers.bind(t,e),5)))},t.getReceipeForLayersInCyclopMode=function(e,n){var i=!1,o=e[0].props.initial,s=o.baseRotation,r=o.imageFolderName,l=o.scaleX,c=o.scaleY,d=o.skewX,u=o.skewY,g=o.timepieceCenterX,m=o.timepieceCenterY,h={},f=1,p=0,v=0,w=null,y=null,T=null,D=null,C=0,M=0;if(1==t.watch.hasCyclop){var b=e[1].props.initial;w=b.fileName,(y=b.maskFileName)&&((T=t.assetManager.getImage({imageFolderName:r,fileName:y}))?(null==b._maskBounds&&(i=!0,b._maskBounds=t.watch.toolbox.getContentBounds(T)),D=b._maskBounds):i=!0),1==n&&(b.cyclopX,b.cyclopY,p=b.timepieceOffsetX,v=b.timepieceOffsetY,f=b.zoomCoef,null!=D&&(C=D.x,M=D.y))}for(var I={},O=0;O<e.length;O++){var S=(k=e[O]).type,F=k.props.initial;"movingContent"==S&&F.id&&(I[F.id]=k)}var A=[];for(O=0;O<e.length;O++){S=(k=e[O]).type,F=k.props.initial;var k,N=k.props.current,x=F.effectOfCyclop,W=F.isOptional,P=F._internalId;1==n&&(P+="_underCyclop");var E=f,R=p,_=v,Y=C,X=M;if("none"==x&&(E=1,R=0,_=0,Y=0,X=0,0,0),"timepieceCenter"==S)h[F.id]={x:F.x,y:F.y};else if(0==n&&"newWatch"==S){var L=F.backgroundFileName;if(L){(J=t.assetManager.getImage({imageFolderName:r,fileName:L}))?a(J.width,J.height):i=!0}else{var j=F.width,U=F.height;j>0&&U>0?a(j,U):t.watch.logger.logWarning("OTW3 has no size: not given in arguments, nor with an image")}}else if("staticContent"==S&&1==t.renderer.renderStaticContents){var H=!0;if(1==n&&"hide"==x&&(H=!1),1==H)(J=t.assetManager.getImage({imageFolderName:r,fileName:F.fileName}))?A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:F.fileName,x:F.x-C,y:F.y-M,angleInDegrees:0,scaleX:1,scaleY:1}):i=!0}else if("dynamicContent"==S&&1==t.renderer.renderDynamicContents){H=!0;if(1==n&&"hide"==x&&(H=!1),1==H)(J=t.assetManager.getImage({imageFolderName:r,fileName:N.targetFileName}))?A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:N.targetFileName,x:N.targetX-C,y:N.targetY-M,angleInDegrees:0,scaleX:1,scaleY:1}):i=!0}else if("movingContent"==S&&1==t.renderer.renderMovingContents){H=!0;if(1==n&&"hide"==x&&(H=!1),1==W&&1==t.watch.hasPoorPerformances&&(H=!1),1==H){var B=F.scaleX;0==B&&(B=l),B*=E;var V=F.scaleY;0==V&&(V=c),V*=E;var z=F.skewX;0==z&&(z=d);var J,q=F.skewY;if(0==q&&(q=u),J=t.assetManager.getImage({imageFolderName:r,fileName:F.fileName})){var Q=null;F.maskFileName&&(Q=t.assetManager.getImage({imageFolderName:r,fileName:F.maskFileName}));var G=null;F.maskedById&&I[F.maskedById]&&(G=I[F.maskedById]);var K,Z,$=F.timepieceCenterId;$?h[$]?(K=h[$].x,Z=h[$].y):(t.watch.logger.logWarning('OTW3 could not find timepieceCenterId "'+$+'". Falling back to default center'),K=g,Z=m):(K=g,Z=m),Q&&(A.push({action:"resetTransform"}),A.push({action:"startMask",img:Q,x:-Y,y:-X,imageFolderName:r,imgFileName:F.maskFileName,maskMode:F.maskMode,width:Q.width,height:Q.height}));var ee=0,te=0,ae=0;if(G){var ne=t.watch.toolbox.getCloneOf(G),ie=ne.props.initial;ie.visualEffect=null;var oe=[];oe.push(e[0]),1==n&&(oe.push(e[1]),2),ie.isMaskOnly=!1,oe.push(ne);var se=t.getReceipeForLayersInCyclopMode(oe,n);if(se){var re=se[0];ee=re.angleInDegrees;var le=t.watch.toolbox.degreesToRadians(-ee),ce=1/(B/100),de=1/(V/100),ue=Math.cos(le),ge=Math.sin(le),me=(ie.offsetX-F.offsetX)*ce,he=(ie.offsetY-F.offsetY)*de;te=re.x-ne.props.initial.offsetX+(me*ue-he*ge),ae=re.y-ne.props.initial.offsetY+(me*ge+he*ue),A.push({action:"startMovingMask",imageFolderName:re.imageFolderName,fileName:re.fileName,x:re.x,y:re.y,angleInDegrees:re.angleInDegrees,scaleX:re.scaleX,scaleY:re.scaleY,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY,skewX:re.skewX,skewY:re.skewY})}}for(var fe=N.targetRotation+s-ee;fe<0;)fe+=360;if(fe%=360,G?A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:F.fileName,x:K+R-Y-F.anchorPointX-te-ne.props.initial.maskedContentAnchorPointX,y:Z+_-X-F.anchorPointY-ae-ne.props.initial.maskedContentAnchorPointY,angleInDegrees:fe,scaleX:1,scaleY:1,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY,skewX:0,skewY:0}):0==F.isMaskOnly&&(F.maskFileName&&(Y=0,X=0),A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:F.fileName,x:K+R+F.offsetX-Y-F.anchorPointX-te,y:Z+_+F.offsetY-X-F.anchorPointY-ae,angleInDegrees:fe,scaleX:B/100,scaleY:V/100,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY,skewX:z,skewY:q})),F.visualEffect&&1==t.renderer.renderVisualEffects&&"overlayOpacityForRotation"==F.visualEffect.type)for(var pe=0;pe<F.visualEffect.elements.length;pe++){var ve,we,ye,Te,De=F.visualEffect.elements[pe],Ce=N.visualEffect.elements[pe];if(t.assetManager.getImage({imageFolderName:r,fileName:De._fileName})){if(1==Ce.rotationIsInRange)G?(ve=1,we=1,ye=0,Te=0):(ve=B/100,we=V/100,ye=z,Te=q),G?A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:De._fileName,x:K+R-C-F.anchorPointX-te-ne.props.initial.maskedContentAnchorPointX,y:Z+_-M-F.anchorPointY-ae-ne.props.initial.maskedContentAnchorPointY,opacity:Ce.targetOpacity,angleInDegrees:fe,scaleX:ve,scaleY:we,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY,skewX:ye,skewY:Te}):A.push({action:"drawImage",_internalId:P,imageFolderName:r,fileName:De._fileName,x:K+R+F.offsetX-C-F.anchorPointX-te,y:Z+_+F.offsetY-M-F.anchorPointY-ae,opacity:Ce.targetOpacity,angleInDegrees:fe,scaleX:ve,scaleY:we,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY,skewX:ye,skewY:Te})}else i=!0}(Q||G)&&A.push({action:"endMask"})}else i=!0}}}1==t.watch.hasCyclop&&(null!=w&&((J=t.assetManager.getImage({imageFolderName:r,fileName:w}))||(i=!0)));return 1==i?(t.hasAtLeastOneMissingImage=!0,null):(t.hasAtLeastOneMissingImage=!1,A)}}function OTW3_renderer(e){var t=this;t.watch=e.watch,t.mode="canvas",t.engine=null,t.targetElement=null,t.optimizeRenderingReceipes=!0,t.renderVisualEffects=!0,t.renderStaticContents=!0,t.renderDynamicContents=!0,t.renderMovingContents=!0,t.allowAutoSwitchToCanvasFor={},t.allowAutoSwitchToCanvasFor.downloadSnapshot=!1,t.die=function(){t.watch.toolbox.removeAllChildrenFromNode(this.targetElement),t.engine&&(t.engine.die(),t.engine=null),t.watch=null,delete t.watch},t.initInMode=function(e){e||(e=t.mode),"css"!=e||0!=t.watch.isCompatibleWithRenderingModeCss?t.mode==e&&null!=t.engine||(null!=t.engine&&(t.watch.toolbox.removeAllChildrenFromNode(t.targetElement),t.engine.die()),t.engine="canvas"==e?new OTW3_canvasRendererEngine({renderer:t}):new OTW3_cssRendererEngine({renderer:t}),t.targetElement&&t.engine.setTargetElement(t.targetElement),t.mode=e,t.watch.layers.length>0&&t.watch.movement.movementDidTick()):this.watch.logger.logWarning('OTW3_renderer "initInMode" will not switch to "css" because implementation is not compatible.')},t.setTargetElement=function(e){e&&(t.targetElement=e,null!=t.engine&&t.engine.setTargetElement(e))},t.setScale=function(e,a){"canvas"==t.mode&&null!=t.engine&&t.engine.setScale(e,a)},t.setAntiAliasingAmount=function(e){"canvas"==t.mode&&null!=t.engine&&t.engine.setAntiAliasingAmount(e)},t.applyRenderingReceipeToCanvasContext=function(e,a,n,i){null!=t.engine&&t.engine.applyRenderingReceipeToCanvasContext(e,a,n,i)},t.getFrameForCurrentLayers=function(){null!=t.engine&&t.engine.getFrameForCurrentLayers()},t.getCompleteOutputDataForLayers=function(e){var a;return null!=t.engine&&(a=t.engine.getCompleteOutputDataForLayers(e)),a},t.initInMode()}function OTW3_snapshotManager(e){this.watch=e.watch,this.timeout,this.die=function(){clearTimeout(this.timeout),this.timeout=null,delete this.timeout,this.watch=null,delete this.watch},this.getSnapshotImage=function(e){e||(e={});var a,n=this.watch.toolbox.getCloneOf(this.watch.layers),i=e._actualDateToDisplay;i&&(a=1==e.shouldIgnoreDateModifications?null:this.watch.toolbox.getCloneOf(this.watch.movement.offsetsFor),this.watch.movement.applyStatusToLayers(n,a,{date:i,ignoreTimezone:e.shouldIgnoreDateModifications,ignoreTimeOffsets:e.shouldIgnoreDateModifications,ignoreDst:e.shouldIgnoreDateModifications}));var o=this.watch.renderer.getCompleteOutputDataForLayers(n);if(o.receipeForRegularTimepiece){var s=this.watch.renderer.engine.overallWidth,r=this.watch.renderer.engine.overallHeight,l=e.width;void 0===l&&(l=s);var c=e.height;void 0===c&&(c=r);var d=e.x;void 0===d&&(d=0);var u=e.y;void 0===u&&(u=0);var g=document.createElement("CANVAS"),m=g.getContext("2d");g.setAttribute("width",l),g.setAttribute("height",c),this.watch.layers[0].props.initial.backgroundFileName&&(e.backgroundImages||(e.backgroundImages=[]),e.backgroundImages.push({fileName:this.watch.layers[0].props.initial.backgroundFileName,x:0,y:0})),e.backgroundImages&&t(e.backgroundImages,m);var h=document.createElement("CANVAS"),f=h.getContext("2d");return h.setAttribute("width",s),h.setAttribute("height",r),this.watch.renderer.applyRenderingReceipeToCanvasContext(o.receipeForRegularTimepiece,o.receipeForMagnifiedTimepiece,o.layers,f),m.drawImage(h,0,0,s,r,d,u,s,r),e.foregroundImages&&t(e.foregroundImages,m),g.toDataURL("image/png")}return this.timeout=setTimeout(this.downloadSnapshotImage.bind(this,e),100),null};var t=function(e,t){if(t){if(e)for(var a=0;a<e.length;a++){var n=e[a];n.image?t.drawImage(n.image,n.x,n.y):n.fileName&&t.drawImage(this.watch.assetManager.imagesByFolderName[this.watch.layers[0].props.initial.imageFolderName][n.fileName],n.x,n.y)}}else this.watch.logger.logWarning('OTW3_snapshotManager "addImagesToCanvasContext" called with no "p_canvasContext"')}.bind(this);this.getSnapshotObject=function(e){e||(e={}),e.shouldIgnoreDateModifications=!1;var t,a=e.date,n=!1;"[object Date]"===Object.prototype.toString.call(a)?(t=a,n=!0):"defaultStaticDisplayDate"==a?(e.shouldIgnoreDateModifications=!0,t=this.watch.movement.defaultStaticDisplayDate,n=!1):"now"==a?(e.shouldIgnoreDateModifications=!0,t=new Date,n=!0):(t=null,n=1!=this.watch.movement.isDisplayingDefaultStaticDate),e._actualDateToDisplay=t;var i,o=this.getSnapshotImage(e);if(null==o)return null;if(e.fileName)i=e.fileName;else{var s="";if(1==n){var r;if(null==t)for(var l=0;l<this.watch.layers.length;l++){var c=this.watch.layers[l],d=c.props.initial,u=c.props.current,g=d.timezone;if("deviceTime"==g){t=u.date.dateObj;break}g&&(r=u.date.dateObj)}null==t&&(t=r),s+="-",s+=t.getFullYear().toString(),s+="-",s+=(t.getMonth()+1).toString(),s+="-",s+=t.getDate().toString(),s+="-",t.getHours()<10&&(s+="0"),s+=t.getHours().toString(),s+="-",t.getMinutes()<10&&(s+="0"),s+=t.getMinutes().toString(),s+="-",t.getSeconds()<10&&(s+="0"),s+=t.getSeconds().toString(),s+="-",t.getMilliseconds()<10?s+="00":t.getMilliseconds()<100&&(s+="0"),s+=t.getMilliseconds().toString()}i=this.watch.id+s+".png"}return{image:o,fileName:i}},this.downloadSnapshotImage=function(e){e||(e={});var t=this.getSnapshotObject(e);if(t){var a=document.createElement("a");if(a.href=t.image,a.download=t.fileName,(document.body||document.documentElement).appendChild(a),a.click){var n=(new Date).getMilliseconds();this.timeout=setTimeout(function(){a.click()}.bind(this),n)}}}}function OTW3_scenarioManager(e){this.watch=e.watch,this.timer=null,this.die=function(){clearInterval(this.timer),this.timer=null,delete this.timer},this.followScenario=function(e,t){if(t||(t=0),t<e.length){var a,n=e[t];if("pauseDuration"!=(a=isNaN(n)?"string"==typeof n?"publicMethod":"providedFunction":"pauseDuration")){var i=0;if(t-1>=0&&(isNaN(e[t-1])||(i=e[t-1])),"publicMethod"==a)if("preload"==n)this.watch.eventManager.addCallbackForEvent("allNecessaryImagesLoaded",this.followScenario.bind(this,e,t+1)),i>0?this.scenarioTimer=setTimeout(function(){this.watch.assetManager.loadAllNecessaryAssetsNow().bind(this.watch)}.bind(this),i):this.watch.assetManager.loadAllNecessaryAssetsNow();else{var o=n.split("(")[0],s=n.split(")")[0].split("(")[1];s||(s="");var r,l="["+s+"]",c=JSON.parse(l);switch(o){case"addTimeOffset":case"jumpToDate":case"jumpToDateAndPause":case"jumpToDateAndRun":case"jumpToDefaultStaticDisplayDate":case"jumpToDisplayDate":case"jumpToDisplayDateAndPause":case"jumpToDisplayDateAndRun":case"pause":case"resetChrono":case"resetCountdown":case"resetTimeOffset":case"run":case"setTimeOffset":case"spinToDate":case"spinToDateAndPause":case"spinToDateAndRun":case"spinToDefaultStaticDisplayDate":case"spinToDisplayDate":case"spinToDisplayDateAndPause":case"spinToDisplayDateAndRun":case"startChrono":case"startCountdown":case"stopChrono":case"stopCountdown":r=this.watch[o].bind(this.watch);break;default:r=null,this.watch.logger.logWarning("OTW3_scenarioManager "+o+" is not supported, will do nothing")}null!=r&&(i>0?c.length>0?this.timer=setTimeout(function(){r.apply(this,c),this.followScenario(e,t+1)}.bind(this),i):this.timer=setTimeout(function(){r(),this.followScenario(e,t+1)}.bind(this),i):(c.length>0?r.apply(this,c):r(),this.followScenario(e,t+1)))}else i>0?this.timer=setTimeout(function(){n(),this.followScenario(e,t+1)}.bind(this),i):(n(),this.followScenario(e,t+1))}else this.followScenario(e,t+1)}}}function OTW3_toolbox(){this.getTransformObject=function(e,t,a,n,i,o,s){function r(e){var t=Math.cos(e),a=Math.sin(e),n=u[0]*t+u[2]*a,i=u[1]*t+u[3]*a,o=-u[0]*a+u[2]*t,s=-u[1]*a+u[3]*t;u[0]=n,u[1]=i,u[2]=o,u[3]=s}function l(e,t){u[0]*=e,u[1]*=e,u[2]*=t,u[3]*=t}function c(e,t){u[4]+=u[0]*e+u[2]*t,u[5]+=u[1]*e+u[3]*t}function d(e,t){u[0]+=u[2]*t,u[1]+=u[3]*t,u[2]+=u[0]*e,u[3]+=u[1]*e}var u=[1,0,0,1,0,0];c(e,t),l(n,i),d(o,s),r(this.degreesToRadians(a));var g={action:"setTransform"};return g.a=u[0],g.b=u[1],g.c=u[2],g.d=u[3],g.e=u[4],g.f=u[5],g},this.getContentBounds=function(e){var t=99999999999999,a=-1,n=99999999999999,i=-1,o=document.createElement("CANVAS");o.setAttribute("width",e.width),o.setAttribute("height",e.height);var s=o.getContext("2d");s.drawImage(e,0,0);for(var r=s.getImageData(0,0,e.width,e.height).data,l=r.length,c=0;c<l;c+=4)if(0!==r[c+3]){var d=c/4%e.width,u=~~(c/4/e.width);d<t&&(t=d),d>a&&(a=d),u<n&&(n=u),u>i&&(i=u)}return{x:t,y:n,width:a-t+1,height:i-n+1}},this.degreesToRadians=function(e){for(;e<0;)e+=360;return(e%=360)*(Math.PI/180)},this.getCloneOf=function(e){if(void 0!==e)return null===e?null:JSON.parse(JSON.stringify(e))},this.getEasedValue=function(e,t,a,n,i){switch(e){case"easeLinear":return n*t/i+a;case"easeInOutQuad":return(t/=i/2)<1?n/2*t*t+a:-n/2*(--t*(t-2)-1)+a;default:console.log('OTW3_toolbox "getEasedValue" does not recognize equation "'+e+'"')}},this.getInvertedAlphaDataUrlFromImage=function(e){if(e){var t=document.createElement("CANVAS");t.style.width=e.width+"px",t.style.height=e.height+"px",t.setAttribute("width",e.width),t.setAttribute("height",e.height);var a=t.getContext("2d");a.drawImage(e,0,0);var n=a.getImageData(0,0,t.width,t.height),i=n.data;for(e=0;e<i.length;e+=4)i[e]=255,i[e+1]=255,i[e+2]=255,i[e+3]=255-i[e+3];return a.putImageData(n,0,0),t.toDataURL("image/png")}return console.log("pb"),null},this.getTimestampForNow=function(){return"undefined"!=typeof performance?performance.now():Date.now()},this.getStringFromTextFileAtUrl=function(e,t){var a,n=new XMLHttpRequest;return n.withCredentials=t,n.onreadystatechange=function(){4===n.readyState&&(a=n.status>=200&&n.status<300?n.responseText:null)},n.open("GET",e,!1),n.send(null),a},this.getDataFromJsonFileAtUrl=function(e,t){var a=this.getStringFromTextFileAtUrl(e,t);return a?JSON.parse(a):null},this.removeAllChildrenFromNode=function(e){if(e)for(;e.firstChild;)e.removeChild(e.lastChild)},this.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}}function OTW3Transitional(e){var t="bottom",a="contentType",n="cycleDuration",i="cycleTimeUnit",o="date",s="elements",r="fullYear",l="hours",c="jumpToDefaultStaticDisplayDate",d="left",u="lightEffects",g="minutes",m="month",h="onSpinUpdateMoment",f="preload",p="right",v="seconds",w="spinToDateAndRun",y="startOption",T="top",D="type",C="x",M="xPos",b="y",I="yPos",O="_light",S="_shade",F=this;if(!e||""==e)throw"OTW3Transitional has to be instantiated with an ID (String) as an argument!";var A=new OTW3({id:e,isTransitionalFromCodeVersion2:!0});F.globalWatch=A.renderer.globalContainer,F.dynamicElementsCanUpdateDuringSpin=!1,F.globalWatch_delayBeforeSpin=2e3;var k=function(e,t,a){void 0!==e[t]&&(e[a]=e[t],delete e[t])},N=function(e,t,a,n){e[t]&&e[t]===a&&(e[t]=n)},x=function(e,t){A.addTimeOffset(e,t)},W=function(e,t){A.setTimeOffset(e,t)},P=function(e){A.followScenario(e)},E=function(e,t,a,n,i,o){e.push({fileNameSuffix:t,rotationStart:a,rotationEnd:n,opacityStart:i,opacityEnd:o,easingEquation:"easeLinear"})};F.addDateOffset=function(e){x(o,e)},F.addDynamicContent=function(e){var t;k(e,M,C),k(e,I,b),N(e,a,"monthdate",o),N(e,a,"weekday","day"),N(e,a,"yearmonth",m),t=1==F.dynamicElementsCanUpdateDuringSpin?0:100,e[h]=t,A.addDynamicContent(e)},F.addFullYearOffset=function(e){x(r,e)},F.addHoursOffset=function(e){x(l,e)},F.addMinutesOffset=function(e){x(g,e)},F.addMonthOffset=function(e){x(m,e)},F.addRotatedContent=function(e){k(e,"centerName","timepieceCenterId"),k(e,"cycleTime",n),k(e,"cycleType",i),k(e,"maskName","maskFileName"),k(e,"xCenter","anchorPointX"),k(e,"xOffset","offsetX"),k(e,"yCenter","anchorPointY"),k(e,"yOffset","offsetY"),N(e,i,"days",o),"moons"==e[i]&&(e.rotationOffset=180);var a=e[u];if(null===a&&delete e[u],a){var r={};r[D]="overlayOpacityForRotation",r[s]=[];var l,c=r[s];l=T+S,a.indexOf(l)>-1&&(E(c,l,90,180,0,1),E(c,l,180,270,1,0)),l=t+O,a.indexOf(l)>-1&&(E(c,l,90,180,0,1),E(c,l,180,270,1,0)),l=t+S,a.indexOf(l)>-1&&(E(c,l,270,360,0,1),E(c,l,0,90,1,0)),l=T+O,a.indexOf(l)>-1&&(E(c,l,270,360,0,1),E(c,l,0,90,1,0)),l=d+S,a.indexOf(l)>-1&&(E(c,l,180,270,0,1),E(c,l,270,360,1,0)),l=p+O,a.indexOf(l)>-1&&(E(c,l,180,270,0,1),E(c,l,270,360,1,0)),l=p+S,a.indexOf(l)>-1&&(E(c,l,0,90,0,1),E(c,l,90,180,1,0)),l=d+O,a.indexOf(l)>-1&&(E(c,l,0,90,0,1),E(c,l,90,180,1,0)),delete e[u],e.visualEffect=r}"countdown_minutes"==e[i]&&(e[n]=10,e.rotationMin=-120,e.rotationMax=120,e.cycleCountLimit=1),A.addMovingContent(e)},F.addSecondsOffset=function(e){x(v,e)},F.addStaticContent=function(e){k(e,M,C),k(e,I,b),A.addStaticContent(e)},F.addTimepieceCenter=function(e){k(e,"name","id"),k(e,M,C),k(e,I,b),A.addTimepieceCenter(e)},F.addTimepieceUnderCyclop=function(e){k(e,"cyclopXPos","cyclopX"),k(e,"cyclopYPos","cyclopY"),k(e,"timepieceXOffset","timepieceOffsetX"),k(e,"timepieceYOffset","timepieceOffsetY"),k(e,"zoomValue","zoomCoef"),A.addTimepieceUnderCyclop(e)},F.createNewWatch=function(e){k(e,"imageFolder","imageFolderName"),k(e,"timePieceXCenter","timepieceCenterX"),k(e,"timePieceYCenter","timepieceCenterY"),k(e,"xScale","scaleX"),k(e,"xSkew","skewX"),k(e,"yScale","scaleY"),k(e,"ySkew","skewY"),A.createNewWatch(e)},Object.defineProperty(this,"defaultPositionDate",{get:function(){return A.defaultStaticDisplayDate},set:function(e){A.defaultStaticDisplayDate=e}}),F.delete=function(){A.delete()},F.downloadSnapShotImage=function(e){A.downloadSnapshotImage(e)},F.getInformations=function(){A.getInformations()},F.pauseWatchRun=function(){A.pause()},F.resetChronoMovement=function(){A.resetChrono()},F.setDateOffset=function(e){W(o,e)},F.setDateShouldUpdateBeforeSpinTo=function(e){var t;this.dynamicElementsCanUpdateDuringSpin=e,t=1==e?0:100;for(var a=0;a<A.layers.length;a++)"dynamicContent"==A.layers[a][D]&&(A.layers[a].props.initial[h]=t)},F.setFullYearOffset=function(e){W(r,e)},F.setHandsToDefaultPosition=function(e){A.jumpToDefaultStaticDisplayDate()},F.setHoursOffset=function(e){W(l,e)},F.setMinutesOffset=function(e){W(g,e)},F.setMonthOffset=function(e){W(m,e)},F.setSecondsOffset=function(e){W(v,e)},F.showAndRun=function(e){k(e,"targetDivName","targetElementId"),N(e,y,"defaultTime",c),N(e,y,"spinToTime",w),A.setTargetElement(e);var t=e.buildOption,a=e[y];if("preloadAndShow"==t)switch(a){case w:P([f,c,F.globalWatch_delayBeforeSpin,w]);break;case c:P([f,c]);break;default:P([f,"run"])}else if("preloadAndCallBack"==t)P([f,e.loadedCallBack]);else switch(a){case w:P([c,F.globalWatch_delayBeforeSpin,w]);break;case c:A.jumpToDefaultStaticDisplayDate();break;default:A.run()}},F.spinToDefaultPosition=function(){A.spinToDefaultStaticDisplayDate()},F.spinToTimeWithTechElapsedTime=function(e){P([F.globalWatch_delayBeforeSpin,w])},F.spinToTimeWithTechElapsedTimeAndStartCapabilityAfterDelay=function(e,t){P([F.globalWatch_delayBeforeSpin,w,t,"startChrono","startCountdown"])},F.startChronoMovement=function(){A.startChrono()},F.startCountdownMovement=function(){A.startCountdown()},F.stopChronoMovement=function(){A.stopChrono()},F.stopCountdownMovement=function(){A.stopCountdown()},F.unPauseWatchRun=function(){A.spinToDateAndRun()},F.OTW3Object=A}